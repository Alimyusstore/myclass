!function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("zoid",[],factory):"object"==typeof exports?exports.zoid=factory():root.zoid=factory()}("undefined"!=typeof self?self:this,function(){return modules=[function(module,_RECEIVE_MESSAGE_TYPE,__webpack_require__){"use strict";function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var key,source=arguments[i];for(key in source)!{}.hasOwnProperty.call(source,key)||(target[key]=source[key])}return target}).apply(this,arguments)}function utils_isPromise(item){try{if(!item)return!1;if("undefined"!=typeof Promise&&item instanceof Promise)return!0;if("undefined"!=typeof window&&"function"==typeof window.Window&&item instanceof window.Window)return!1;if("undefined"!=typeof window&&"function"==typeof window.constructor&&item instanceof window.constructor)return!1;var _toString={}.toString;if(_toString){var name=_toString.call(item);if("[object Window]"===name||"[object global]"===name||"[object DOMWindow]"===name)return!1}if("function"==typeof item.then)return!0}catch(err){return!1}return!1}__webpack_require__.r(_RECEIVE_MESSAGE_TYPE),__webpack_require__.d(_RECEIVE_MESSAGE_TYPE,"PopupOpenError",function(){return PopupOpenError}),__webpack_require__.d(_RECEIVE_MESSAGE_TYPE,"create",function(){return create}),__webpack_require__.d(_RECEIVE_MESSAGE_TYPE,"destroy",function(){return component_destroy}),__webpack_require__.d(_RECEIVE_MESSAGE_TYPE,"destroyComponents",function(){return destroyComponents}),__webpack_require__.d(_RECEIVE_MESSAGE_TYPE,"destroyAll",function(){return destroyAll}),__webpack_require__.d(_RECEIVE_MESSAGE_TYPE,"PROP_TYPE",function(){return PROP_TYPE}),__webpack_require__.d(_RECEIVE_MESSAGE_TYPE,"PROP_SERIALIZATION",function(){return PROP_SERIALIZATION}),__webpack_require__.d(_RECEIVE_MESSAGE_TYPE,"CONTEXT",function(){return CONTEXT}),__webpack_require__.d(_RECEIVE_MESSAGE_TYPE,"EVENT",function(){return EVENT});var flushPromise,dispatchedErrors=[],possiblyUnhandledPromiseHandlers=[],activeCount=0;function flushActive(){var promise;!activeCount&&flushPromise&&(promise=flushPromise,flushPromise=null,promise.resolve())}function startActive(){activeCount+=1}function endActive(){--activeCount,flushActive()}var promise_ZalgoPromise=((_RECEIVE_MESSAGE_TYPE=ZalgoPromise.prototype).resolve=function(result){if(this.resolved||this.rejected)return this;if(utils_isPromise(result))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=result,this.dispatch(),this},_RECEIVE_MESSAGE_TYPE.reject=function(error){var _err,_this2=this;if(this.resolved||this.rejected)return this;if(utils_isPromise(error))throw new Error("Can not reject promise with another promise");return error||(_err=error&&"function"==typeof error.toString?error.toString():{}.toString.call(error),error=new Error("Expected reject to be called with Error, got "+_err)),this.rejected=!0,this.error=error,this.errorHandled||setTimeout(function(){_this2.errorHandled||function(err,promise){if(-1===dispatchedErrors.indexOf(err)){dispatchedErrors.push(err),setTimeout(function(){throw err},1);for(var j=0;j<possiblyUnhandledPromiseHandlers.length;j++)possiblyUnhandledPromiseHandlers[j](err,promise)}}(error,_this2)},1),this.dispatch(),this},_RECEIVE_MESSAGE_TYPE.asyncReject=function(error){return this.errorHandled=!0,this.reject(error),this},_RECEIVE_MESSAGE_TYPE.dispatch=function(){var resolved=this.resolved,rejected=this.rejected,handlers=this.handlers;if(!this.dispatching&&(resolved||rejected)){this.dispatching=!0,startActive();for(var i=0;i<handlers.length;i++){var _result2=handlers[i],onSuccess=_result2.onSuccess,onError=_result2.onError,promise=_result2.promise,_result2=void 0;if(resolved)try{_result2=onSuccess?onSuccess(this.value):this.value}catch(err){promise.reject(err);continue}else if(rejected){if(!onError){promise.reject(this.error);continue}try{_result2=onError(this.error)}catch(err){promise.reject(err);continue}}_result2 instanceof ZalgoPromise&&(_result2.resolved||_result2.rejected)?(_result2.resolved?promise.resolve(_result2.value):promise.reject(_result2.error),_result2.errorHandled=!0):utils_isPromise(_result2)?_result2 instanceof ZalgoPromise&&(_result2.resolved||_result2.rejected)?_result2.resolved?promise.resolve(_result2.value):promise.reject(_result2.error):function(firstPromise,secondPromise){firstPromise.then(function(res){secondPromise.resolve(res)},function(err){secondPromise.reject(err)})}(_result2,promise):promise.resolve(_result2)}handlers.length=0,this.dispatching=!1,endActive()}},_RECEIVE_MESSAGE_TYPE.then=function(onSuccess,onError){if(onSuccess&&"function"!=typeof onSuccess&&!onSuccess.call)throw new Error("Promise.then expected a function for success handler");if(onError&&"function"!=typeof onError&&!onError.call)throw new Error("Promise.then expected a function for error handler");var promise=new ZalgoPromise;return this.handlers.push({promise:promise,onSuccess:onSuccess,onError:onError}),this.errorHandled=!0,this.dispatch(),promise},_RECEIVE_MESSAGE_TYPE.catch=function(onError){return this.then(void 0,onError)},_RECEIVE_MESSAGE_TYPE.finally=function(onFinally){if(onFinally&&"function"!=typeof onFinally&&!onFinally.call)throw new Error("Promise.finally expected a function");return this.then(function(result){return ZalgoPromise.try(onFinally).then(function(){return result})},function(err){return ZalgoPromise.try(onFinally).then(function(){throw err})})},_RECEIVE_MESSAGE_TYPE.timeout=function(time,err){var _this3=this;if(this.resolved||this.rejected)return this;var timeout=setTimeout(function(){_this3.resolved||_this3.rejected||_this3.reject(err||new Error("Promise timed out after "+time+"ms"))},time);return this.then(function(result){return clearTimeout(timeout),result})},_RECEIVE_MESSAGE_TYPE.toPromise=function(){if("undefined"==typeof Promise)throw new TypeError("Could not find Promise");return Promise.resolve(this)},ZalgoPromise.resolve=function(value){return value instanceof ZalgoPromise?value:utils_isPromise(value)?new ZalgoPromise(function(resolve,reject){return value.then(resolve,reject)}):(new ZalgoPromise).resolve(value)},ZalgoPromise.reject=function(error){return(new ZalgoPromise).reject(error)},ZalgoPromise.asyncReject=function(error){return(new ZalgoPromise).asyncReject(error)},ZalgoPromise.all=function(promises){var promise=new ZalgoPromise,count=promises.length,results=[];if(!count)return promise.resolve(results),promise;for(var i=0;i<promises.length;i++){var prom=promises[i];if(prom instanceof ZalgoPromise){if(prom.resolved){results[i]=prom.value,--count;continue}}else if(!utils_isPromise(prom)){results[i]=prom,--count;continue}!function(i,firstPromise,secondPromise){firstPromise.then(function(res){results[i]=res,0==--count&&promise.resolve(results)},function(err){secondPromise.reject(err)})}(i,ZalgoPromise.resolve(prom),promise)}return 0===count&&promise.resolve(results),promise},ZalgoPromise.hash=function(promises){var result={};return ZalgoPromise.all(Object.keys(promises).map(function(key){return ZalgoPromise.resolve(promises[key]).then(function(value){result[key]=value})})).then(function(){return result})},ZalgoPromise.map=function(items,method){return ZalgoPromise.all(items.map(method))},ZalgoPromise.onPossiblyUnhandledException=function(handler){return possiblyUnhandledPromiseHandlers.push(handler),{cancel:function(){possiblyUnhandledPromiseHandlers.splice(possiblyUnhandledPromiseHandlers.indexOf(handler),1)}}},ZalgoPromise.try=function(method,context,args){if(method&&"function"!=typeof method&&!method.call)throw new Error("Promise.try expected a function");var result;startActive();try{result=method.apply(context,args||[])}catch(err){return endActive(),ZalgoPromise.reject(err)}return endActive(),ZalgoPromise.resolve(result)},ZalgoPromise.delay=function(_delay){return new ZalgoPromise(function(resolve){setTimeout(resolve,_delay)})},ZalgoPromise.isPromise=function(value){return!!(value&&value instanceof ZalgoPromise)||utils_isPromise(value)},ZalgoPromise.flush=function(){return promise=flushPromise=flushPromise||new ZalgoPromise,flushActive(),promise;var promise},ZalgoPromise);function ZalgoPromise(handler){var _this=this;if(this.resolved=void 0,this.rejected=void 0,this.errorHandled=void 0,this.value=void 0,this.error=void 0,this.handlers=void 0,this.dispatching=void 0,this.stack=void 0,this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],handler){var _result,_error,resolved=!1,rejected=!1,isAsync=!1;startActive();try{handler(function(res){isAsync?_this.resolve(res):(resolved=!0,_result=res)},function(err){isAsync?_this.reject(err):(rejected=!0,_error=err)})}catch(err){return endActive(),void this.reject(err)}endActive(),isAsync=!0,resolved?this.resolve(_result):rejected&&this.reject(_error)}}function isRegex(item){return"[object RegExp]"==={}.toString.call(item)}var WINDOW_TYPE={IFRAME:"iframe",POPUP:"popup"},IE_WIN_ACCESS_ERROR="Call was rejected by callee.\r\n";function isAboutProtocol(win){return"about:"===(win=void 0===win?window:win).location.protocol}function utils_getParent(win){if(win=void 0===win?window:win)try{if(win.parent&&win.parent!==win)return win.parent}catch(err){}}function getOpener(win){if((win=void 0===win?window:win)&&!utils_getParent(win))try{return win.opener}catch(err){}}function canReadFromWindow(){try{return 1}catch(err){}}function getActualDomain(parent){var host=(parent=void 0===parent?window:parent).location;if(!host)throw new Error("Can not read window location");var protocol=host.protocol;if(!protocol)throw new Error("Can not read window protocol");if("file:"===protocol)return"file://";if("about:"===protocol){parent=utils_getParent(parent);return parent&&canReadFromWindow()?getActualDomain(parent):"about://"}host=host.hostname;if(!host)throw new Error("Can not read window host");return protocol+"//"+host}function getDomain(win){var domain=getActualDomain(win=void 0===win?window:win);return domain&&win.mockDomain&&0===win.mockDomain.indexOf("mock:")?win.mockDomain:domain}function isSameDomain(win){if(!function(win){try{if(win===window)return 1}catch(err){}try{var desc=Object.getOwnPropertyDescriptor(win,"location");if(desc&&!1===desc.enumerable)return}catch(err){}try{if(isAboutProtocol(win)&&canReadFromWindow())return 1}catch(err){}try{if(getActualDomain(win)===getActualDomain(window))return 1}catch(err){}}(win))return!1;try{if(win===window)return!0;if(isAboutProtocol(win)&&canReadFromWindow())return!0;if(getDomain(window)===getDomain(win))return!0}catch(err){}return!1}function assertSameDomain(win){if(!isSameDomain(win))throw new Error("Expected window to be same domain");return win}function isAncestorParent(parent,child){if(parent&&child){var childParent=utils_getParent(child);return childParent?childParent===parent:-1!==function(win){var result=[];try{for(;win.parent!==win;)result.push(win.parent),win=win.parent}catch(err){}return result}(child).indexOf(parent)}}function getFrames(win){var frames,len,result=[];try{frames=win.frames}catch(err){frames=win}try{len=frames.length}catch(err){}if(0===len)return result;if(len){for(var i=0;i<len;i++){var frame=void 0;try{frame=frames[i]}catch(err){continue}result.push(frame)}return result}for(var _i=0;_i<100;_i++){var _frame=void 0;try{_frame=frames[_i]}catch(err){return result}if(!_frame)return result;result.push(_frame)}return result}function getAllChildFrames(win){for(var result=[],_i3=0,_getFrames2=getFrames(win);_i3<_getFrames2.length;_i3++){var frame=_getFrames2[_i3];result.push(frame);for(var _i5=0,_getAllChildFrames2=getAllChildFrames(frame);_i5<_getAllChildFrames2.length;_i5++)result.push(_getAllChildFrames2[_i5])}return result}function getTop(win){void 0===win&&(win=window);try{if(win.top)return win.top}catch(err){}if(utils_getParent(win)===win)return win;try{if(isAncestorParent(window,win)&&window.top)return window.top}catch(err){}try{if(isAncestorParent(win,window)&&window.top)return window.top}catch(err){}for(var _i7=0,_getAllChildFrames4=getAllChildFrames(win);_i7<_getAllChildFrames4.length;_i7++){var frame=_getAllChildFrames4[_i7];try{if(frame.top)return frame.top}catch(err){}if(utils_getParent(frame)===frame)return frame}}function getAllFramesInWindow(win){var result=getTop(win);if(!result)throw new Error("Can not determine top window");result=[].concat(getAllChildFrames(result),[result]);return result=-1===result.indexOf(win)?[].concat(result,[win],getAllChildFrames(win)):result}var iframeWindows=[],iframeFrames=[];function isWindowClosed(frame,allowMock){void 0===allowMock&&(allowMock=!0);try{if(frame===window)return!1}catch(err){return!0}try{if(!frame)return!0}catch(err){return!0}try{if(frame.closed)return!0}catch(err){return!err||err.message!==IE_WIN_ACCESS_ERROR}if(allowMock&&isSameDomain(frame))try{if(frame.mockclosed)return!0}catch(err){}try{if(!frame.parent||!frame.top)return!0}catch(err){}frame=function(collection,item){for(var i=0;i<collection.length;i++)try{if(collection[i]===item)return i}catch(err){}return-1}(iframeWindows,frame);if(-1!==frame){frame=iframeFrames[frame];if(frame&&function(frame){if(!frame.contentWindow)return 1;if(!frame.parentNode)return 1;var doc=frame.ownerDocument;if(doc&&doc.documentElement&&!doc.documentElement.contains(frame)){for(var parent=frame;parent.parentNode&&parent.parentNode!==parent;)parent=parent.parentNode;if(!parent.host||!doc.documentElement.contains(parent.host))return 1}}(frame))return!0}return!1}function utils_getUserAgent(win){return(win=win||window).navigator.mockUserAgent||win.navigator.userAgent}function getFrameByName(win,name){for(var winFrames=getFrames(win),_i9=0;_i9<winFrames.length;_i9++){var childFrame=winFrames[_i9];try{if(isSameDomain(childFrame)&&childFrame.name===name&&-1!==winFrames.indexOf(childFrame))return childFrame}catch(err){}}try{if(-1!==winFrames.indexOf(win.frames[name]))return win.frames[name]}catch(err){}try{if(-1!==winFrames.indexOf(win[name]))return win[name]}catch(err){}}function isOpener(parent,child){return parent===getOpener(child)}function getAncestor(win){return getOpener(win=(win=void 0===win?window:win)||window)||utils_getParent(win)||void 0}function anyMatch(collection1,collection2){for(var _i17=0;_i17<collection1.length;_i17++)for(var item1=collection1[_i17],_i19=0;_i19<collection2.length;_i19++)if(item1===collection2[_i19])return 1}function getDistanceFromTop(win){for(var distance=0,parent=win=void 0===win?window:win;parent;)(parent=utils_getParent(parent))&&(distance+=1);return distance}function isSameTopWindow(allFrames1,allFrames2){var opener1=getTop(allFrames1)||allFrames1,opener2=getTop(allFrames2)||allFrames2;try{if(opener1&&opener2)return opener1===opener2}catch(err){}allFrames1=getAllFramesInWindow(allFrames1),allFrames2=getAllFramesInWindow(allFrames2);if(anyMatch(allFrames1,allFrames2))return!0;opener1=getOpener(opener1),opener2=getOpener(opener2);return opener1&&anyMatch(getAllFramesInWindow(opener1),allFrames2)||opener2&&anyMatch(getAllFramesInWindow(opener2),allFrames1),!1}function matchDomain(pattern,origin){if("string"==typeof pattern){if("string"==typeof origin)return"*"===pattern||origin===pattern;if(isRegex(origin))return!1;if(Array.isArray(origin))return!1}return isRegex(pattern)?isRegex(origin)?pattern.toString()===origin.toString():!Array.isArray(origin)&&Boolean(origin.match(pattern)):!!Array.isArray(pattern)&&(Array.isArray(origin)?JSON.stringify(pattern)===JSON.stringify(origin):!isRegex(origin)&&pattern.some(function(subpattern){return matchDomain(subpattern,origin)}))}function getDomainFromUrl(url){return url.match(/^(https?|mock|file):\/\//)?url.split("/").slice(0,3).join("/"):getDomain()}function onCloseWindow(win,callback,delay,maxtime){var timeout;return void 0===delay&&(delay=1e3),void 0===maxtime&&(maxtime=1/0),function check(){return isWindowClosed(win)?(timeout&&clearTimeout(timeout),callback()):void(maxtime<=0?clearTimeout(timeout):(maxtime-=delay,timeout=setTimeout(check,delay)))}(),{cancel:function(){timeout&&clearTimeout(timeout)}}}function isWindow(obj){try{if(obj===window)return 1}catch(err){if(err&&err.message===IE_WIN_ACCESS_ERROR)return 1}try{if("[object Window]"==={}.toString.call(obj))return 1}catch(err){if(err&&err.message===IE_WIN_ACCESS_ERROR)return 1}try{if(window.Window&&obj instanceof window.Window)return 1}catch(err){if(err&&err.message===IE_WIN_ACCESS_ERROR)return 1}try{if(obj&&obj.self===obj)return 1}catch(err){if(err&&err.message===IE_WIN_ACCESS_ERROR)return 1}try{if(obj&&obj.parent===obj)return 1}catch(err){if(err&&err.message===IE_WIN_ACCESS_ERROR)return 1}try{if(obj&&obj.top===obj)return 1}catch(err){if(err&&err.message===IE_WIN_ACCESS_ERROR)return 1}try{if(obj&&"__unlikely_value__"===obj.__cross_domain_utils_window_check__)return}catch(err){return 1}}function normalizeMockUrl(url){if(0!==getDomainFromUrl(url).indexOf("mock:"))return url;throw new Error("Mock urls not supported out of test mode")}function closeWindow(win){try{win.close()}catch(err){}}function util_safeIndexOf(collection,item){for(var i=0;i<collection.length;i++)try{if(collection[i]===item)return i}catch(err){}return-1}var objectIDs,weakmap_CrossDomainSafeWeakMap=function(){function CrossDomainSafeWeakMap(){if(this.name=void 0,this.weakmap=void 0,this.keys=void 0,this.values=void 0,this.name="__weakmap_"+(1e9*Math.random()>>>0)+"__",function(){if("undefined"!=typeof WeakMap&&void 0!==Object.freeze)try{var testWeakMap=new WeakMap,testKey={};return Object.freeze(testKey),testWeakMap.set(testKey,"__testvalue__"),"__testvalue__"===testWeakMap.get(testKey)}catch(err){return}}())try{this.weakmap=new WeakMap}catch(err){}this.keys=[],this.values=[]}var _proto=CrossDomainSafeWeakMap.prototype;return _proto._cleanupClosedWindows=function(){for(var weakmap=this.weakmap,keys=this.keys,i=0;i<keys.length;i++){var value=keys[i];if(isWindow(value)&&isWindowClosed(value)){if(weakmap)try{weakmap.delete(value)}catch(err){}keys.splice(i,1),this.values.splice(i,1),--i}}},_proto.isSafeToReadWrite=function(key){return!isWindow(key)},_proto.set=function(key,value){if(!key)throw new Error("WeakMap expected key");var keys=this.weakmap;if(keys)try{keys.set(key,value)}catch(err){delete this.weakmap}if(this.isSafeToReadWrite(key))try{var index=this.name,values=key[index];return void(values&&values[0]===key?values[1]=value:Object.defineProperty(key,index,{value:[key,value],writable:!0}))}catch(err){}this._cleanupClosedWindows();keys=this.keys,values=this.values,index=util_safeIndexOf(keys,key);-1===index?(keys.push(key),values.push(value)):values[index]=value},_proto.get=function(index){if(!index)throw new Error("WeakMap expected key");var weakmap=this.weakmap;if(weakmap)try{if(weakmap.has(index))return weakmap.get(index)}catch(err){delete this.weakmap}if(this.isSafeToReadWrite(index))try{var entry=index[this.name];return entry&&entry[0]===index?entry[1]:void 0}catch(err){}this._cleanupClosedWindows();index=util_safeIndexOf(this.keys,index);if(-1!==index)return this.values[index]},_proto.delete=function(index){if(!index)throw new Error("WeakMap expected key");var weakmap=this.weakmap;if(weakmap)try{weakmap.delete(index)}catch(err){delete this.weakmap}if(this.isSafeToReadWrite(index))try{var keys=index[this.name];keys&&keys[0]===index&&(keys[0]=keys[1]=void 0)}catch(err){}this._cleanupClosedWindows();keys=this.keys,index=util_safeIndexOf(keys,index);-1!==index&&(keys.splice(index,1),this.values.splice(index,1))},_proto.has=function(key){if(!key)throw new Error("WeakMap expected key");var weakmap=this.weakmap;if(weakmap)try{if(weakmap.has(key))return!0}catch(err){delete this.weakmap}if(this.isSafeToReadWrite(key))try{var entry=key[this.name];return!(!entry||entry[0]!==key)}catch(err){}return this._cleanupClosedWindows(),-1!==util_safeIndexOf(this.keys,key)},_proto.getOrSet=function(key,value){if(this.has(key))return this.get(key);value=value();return this.set(key,value),value},CrossDomainSafeWeakMap}();function getFunctionName(fn){return fn.name||fn.__name__||fn.displayName||"anonymous"}function setFunctionName(fn,name){try{delete fn.name,fn.name=name}catch(err){}return fn.__name__=fn.displayName=name,fn}function base64encode(str){if("function"==typeof btoa)return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(m,p1){return String.fromCharCode(parseInt(p1,16))}));if("undefined"!=typeof Buffer)return Buffer.from(str,"utf8").toString("base64");throw new Error("Can not find window.btoa or Buffer")}function uniqueID(){var chars="0123456789abcdef";return"xxxxxxxxxx".replace(/./g,function(){return chars.charAt(Math.floor(Math.random()*chars.length))})+"_"+base64encode((new Date).toISOString().slice(11,19).replace("T",".")).replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}function serializeArgs(args){try{return JSON.stringify([].slice.call(args),function(subkey,val){return"function"==typeof val?"memoize["+function(obj){if(objectIDs=objectIDs||new weakmap_CrossDomainSafeWeakMap,null==obj||"object"!=typeof obj&&"function"!=typeof obj)throw new Error("Invalid object");var uid=objectIDs.get(obj);return uid||(uid=typeof obj+":"+uniqueID(),objectIDs.set(obj,uid)),uid}(val)+"]":val})}catch(err){throw new Error("Arguments not serializable -- can not be used to memoize")}}var awaitFrameLoadPromises,memoizedFunctions=[];function memoize(method,options){var _this=this;void 0===options&&(options={});function memoizedFunction(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var cache=cacheMap.getOrSet(options.thisNamespace?this:method,function(){return{}}),key=serializeArgs(args),value=options.time;if(cache[key]&&value&&Date.now()-cache[key].time<value&&delete cache[key],cache[key])return cache[key].value;var time=Date.now(),value=method.apply(this,arguments);return cache[key]={time:time,value:value},cache[key].value}var cacheMap=new weakmap_CrossDomainSafeWeakMap;return memoizedFunction.reset=function(){cacheMap.delete(options.thisNamespace?_this:method)},memoizedFunctions.push(memoizedFunction),setFunctionName(memoizedFunction,(options.name||getFunctionName(method))+"::memoized")}function inlineMemoize(key,logic,args){void 0===args&&(args=[]);var cache=key.__inline_memoize_cache__=key.__inline_memoize_cache__||{},key=serializeArgs(args);return cache.hasOwnProperty(key)?cache[key]:cache[key]=logic.apply(void 0,args)}function src_util_noop(){}function once(method){var called=!1;return setFunctionName(function(){if(!called)return called=!0,method.apply(this,arguments)},getFunctionName(method)+"::once")}function stringifyError(err,level){if(3<=(level=void 0===level?1:level))return"stringifyError stack overflow";try{if(!err)return"<unknown error: "+{}.toString.call(err)+">";if("string"==typeof err)return err;if(err instanceof Error){var stack=err&&err.stack,message=err&&err.message;if(stack&&message)return-1!==stack.indexOf(message)?stack:message+"\n"+stack;if(stack)return stack;if(message)return message}return err&&err.toString&&"function"==typeof err.toString?err.toString():{}.toString.call(err)}catch(newErr){return"Error while stringifying error: "+stringifyError(newErr,level+1)}}function stringify(item){return"string"==typeof item?item:item&&item.toString&&"function"==typeof item.toString?item.toString():{}.toString.call(item)}function extend(obj,source){if(!source)return obj;if(Object.assign)return Object.assign(obj,source);for(var key in source)source.hasOwnProperty(key)&&(obj[key]=source[key]);return obj}function safeInterval(method,time){var timeout;return function loop(){timeout=setTimeout(function(){method(),loop()},time)}(),{cancel:function(){clearTimeout(timeout)}}}function arrayFrom(item){return[].slice.call(item)}function util_isRegex(item){return"[object RegExp]"==={}.toString.call(item)}function util_getOrSet(obj,key,val){if(obj.hasOwnProperty(key))return obj[key];val=val();return obj[key]=val}function cleanup(obj){var tasks=[],cleaned=!1;return{set:function(name,item){return cleaned||(obj[name]=item,this.register(function(){delete obj[name]})),item},register:function(method){cleaned?method():tasks.push(once(method))},all:function(){var results=[];for(cleaned=!0;tasks.length;){var task=tasks.shift();results.push(task())}return promise_ZalgoPromise.all(results).then(src_util_noop)}}}function assertExists(name,thing){if(null==thing)throw new Error("Expected "+name+" to be present");return thing}function isDocumentReady(){return Boolean(document.body)&&"complete"===document.readyState}function urlEncode(str){return str.replace(/\?/g,"%3F").replace(/&/g,"%26").replace(/#/g,"%23").replace(/\+/g,"%2B")}function waitForDocumentReady(){return inlineMemoize(waitForDocumentReady,function(){return new promise_ZalgoPromise(function(resolve){if(isDocumentReady())return resolve();var interval=setInterval(function(){if(isDocumentReady())return clearInterval(interval),resolve()},10)})})}function parseQuery(queryString){return inlineMemoize(parseQuery,function(){var params={};if(!queryString)return params;if(-1===queryString.indexOf("="))return params;for(var _i2=0,_queryString$split2=queryString.split("&");_i2<_queryString$split2.length;_i2++){var pair=_queryString$split2[_i2];(pair=pair.split("="))[0]&&pair[1]&&(params[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1]))}return params},[queryString])}function extendQuery(originalQuery,props){return(props=void 0===props?{}:props)&&Object.keys(props).length?(void 0===(obj=_extends({},parseQuery(originalQuery),props))&&(obj={}),Object.keys(obj).filter(function(key){return"string"==typeof obj[key]}).map(function(key){return urlEncode(key)+"="+urlEncode(obj[key])}).join("&")):originalQuery;var obj}function isElement(element){return element instanceof window.Element||null!==element&&"object"==typeof element&&1===element.nodeType&&"object"==typeof element.style&&"object"==typeof element.ownerDocument}function getElementSafe(id,doc){return void 0===doc&&(doc=document),isElement(id)?id:"string"==typeof id?doc.querySelector(id):void 0}function PopupOpenError(message){this.message=message}function awaitFrameLoad(frame){if((awaitFrameLoadPromises=awaitFrameLoadPromises||new weakmap_CrossDomainSafeWeakMap).has(frame)){var promise=awaitFrameLoadPromises.get(frame);if(promise)return promise}promise=new promise_ZalgoPromise(function(resolve,reject){frame.addEventListener("load",function(){!function(frame){if(!function(){for(var i=0;i<iframeWindows.length;i++){var closed=!1;try{closed=iframeWindows[i].closed}catch(err){}closed&&(iframeFrames.splice(i,1),iframeWindows.splice(i,1))}}(),frame&&frame.contentWindow)try{iframeWindows.push(frame.contentWindow),iframeFrames.push(frame)}catch(err){}}(frame),resolve(frame)}),frame.addEventListener("error",function(err){frame.contentWindow?resolve(frame):reject(err)})});return awaitFrameLoadPromises.set(frame,promise),promise}function awaitFrameWindow(frame){return awaitFrameLoad(frame).then(function(loadedFrame){if(!loadedFrame.contentWindow)throw new Error("Could not find window in iframe");return loadedFrame.contentWindow})}function dom_iframe(options,container){(options=void 0===options?{}:options).style;var frame=function(tag,options){void 0===options&&(options={}),tag=(tag=void 0===tag?"div":tag).toLowerCase();var el,styleText,doc,element=document.createElement(tag);if(options.style&&extend(element.style,options.style),options.class&&(element.className=options.class.join(" ")),options.id&&element.setAttribute("id",options.id),options.attributes)for(var _i10=0,_Object$keys2=Object.keys(options.attributes);_i10<_Object$keys2.length;_i10++){var key=_Object$keys2[_i10];element.setAttribute(key,options.attributes[key])}if(options.styleSheet&&(el=element,styleText=options.styleSheet,void 0===doc&&(doc=window.document),el.styleSheet?el.styleSheet.cssText=styleText:el.appendChild(doc.createTextNode(styleText))),options.html){if("iframe"===tag)throw new Error("Iframe html can not be written unless container provided and iframe in DOM");element.innerHTML=options.html}return element}("iframe",{attributes:_extends({allowTransparency:"true"},options.attributes||{}),html:options.html,class:options.class}),isIE=window.navigator.userAgent.match(/MSIE|Edge/i);return frame.hasAttribute("id")||frame.setAttribute("id",uniqueID()),awaitFrameLoad(frame),container&&function(id,element){element=getElementSafe(id,element=void 0===element?document:element);if(element)return element;throw new Error("Can not find element: "+stringify(id))}(container).appendChild(frame),(options.url||isIE)&&frame.setAttribute("src",options.url||"about:blank"),frame}function addEventListener(obj,event,handler){return obj.addEventListener(event,handler),{cancel:function(){obj.removeEventListener(event,handler)}}}function showElement(element){element.style.setProperty("display","")}function hideElement(element){element.style.setProperty("display","none","important")}function destroyElement(element){element&&element.parentNode&&element.parentNode.removeChild(element)}function isElementClosed(el){return!el||!el.parentNode}function onResize(el,handler,_ref2$interval){var win=void 0===_ref2$interval?{}:_ref2$interval,_ref2$interval=win.width,width=void 0===_ref2$interval||_ref2$interval,_ref2$interval=win.height,height=void 0===_ref2$interval||_ref2$interval,_ref2$interval=win.interval,interval=void 0===_ref2$interval?100:_ref2$interval,win=win.win,win=void 0===win?window:win,currentWidth=el.offsetWidth,currentHeight=el.offsetHeight;handler({width:currentWidth,height:currentHeight});function check(){var newWidth=el.offsetWidth,newHeight=el.offsetHeight;(width&&newWidth!==currentWidth||height&&newHeight!==currentHeight)&&handler({width:newWidth,height:newHeight}),currentWidth=newWidth,currentHeight=newHeight}return void 0!==win.ResizeObserver?new win.ResizeObserver(check).observe(el):void 0!==win.MutationObserver?(new win.MutationObserver(check).observe(el,{attributes:!0,childList:!0,subtree:!0,characterData:!1}),win.addEventListener("resize",check)):function loop(){check(),setTimeout(loop,interval)}(),1}function isShadowElement(element){for(;element.parentNode;)element=element.parentNode;return"[object ShadowRoot]"===element.toString()}function isPerc(str){return"string"==typeof str&&/^[0-9]+%$/.test(str)}function toNum(val){if("number"==typeof val)return val;var match=val.match(/^([0-9]+)(px|%)$/);if(!match)throw new Error("Could not match css value from "+val);return parseInt(match[1],10)}function toPx(val){return toNum(val)+"px"}function toCSS(val){return"number"!=typeof val&&isPerc(val)?val:toPx(val)}function normalizeDimension(dim,max){if("number"==typeof dim)return dim;if(isPerc(dim))return parseInt(max*toNum(dim)/100,10);if("string"==typeof dim&&/^[0-9]+px$/.test(dim))return toNum(dim);throw new Error("Can not normalize dimension: "+dim)}function global_getGlobal(win){return(win=void 0===win?window:win)!==window?win.__post_robot_10_0_31__:win.__post_robot_10_0_31__=win.__post_robot_10_0_31__||{}}memoize.clear=function(){for(var _i2=0;_i2<memoizedFunctions.length;_i2++)memoizedFunctions[_i2].reset()},PopupOpenError.prototype=Object.create(Error.prototype);var getObj=function(){return{}};function globalStore(key,defStore){return void 0===key&&(key="store"),void 0===defStore&&(defStore=getObj),util_getOrSet(global_getGlobal(),key,function(){var store=defStore();return{has:function(storeKey){return store.hasOwnProperty(storeKey)},get:function(storeKey,defVal){return store.hasOwnProperty(storeKey)?store[storeKey]:defVal},set:function(storeKey,val){return store[storeKey]=val},del:function(storeKey){delete store[storeKey]},getOrSet:function(storeKey,getter){return util_getOrSet(store,storeKey,getter)},reset:function(){store=defStore()},keys:function(){return Object.keys(store)}}})}var WildCard=function(){};function getWildcard(){var global=global_getGlobal();return global.WINDOW_WILDCARD=global.WINDOW_WILDCARD||new WildCard,global.WINDOW_WILDCARD}function windowStore(key,defStore){return void 0===key&&(key="store"),void 0===defStore&&(defStore=getObj),globalStore("windowStore").getOrSet(key,function(){function getStore(win){return winStore.getOrSet(win,defStore)}var winStore=new weakmap_CrossDomainSafeWeakMap;return{has:function(win){return getStore(win).hasOwnProperty(key)},get:function(store,defVal){store=getStore(store);return store.hasOwnProperty(key)?store[key]:defVal},set:function(win,val){return getStore(win)[key]=val},del:function(win){delete getStore(win)[key]},getOrSet:function(win,getter){return util_getOrSet(getStore(win),key,getter)}}})}function getInstanceID(){return globalStore("instance").getOrSet("instanceID",uniqueID)}function resolveHelloPromise(win,existingPromise){var newPromise=existingPromise.domain,helloPromises=windowStore("helloPromises"),existingPromise=helloPromises.get(win);existingPromise&&existingPromise.resolve({domain:newPromise});newPromise=promise_ZalgoPromise.resolve({domain:newPromise});return helloPromises.set(win,newPromise),newPromise}function sayHello(win,_ref4){return(0,_ref4.send)(win,"postrobot_hello",{instanceID:getInstanceID()},{domain:"*",timeout:-1}).then(function(instanceID){var origin=instanceID.origin,instanceID=instanceID.data.instanceID;return resolveHelloPromise(win,{domain:origin}),{win:win,domain:origin,instanceID:instanceID}})}function getWindowInstanceID(win,_ref6){var send=_ref6.send;return windowStore("windowInstanceIDPromises").getOrSet(win,function(){return sayHello(win,{send:send}).then(function(_ref7){return _ref7.instanceID})})}function awaitWindowHello(promise,timeout,name){void 0===timeout&&(timeout=5e3),void 0===name&&(name="Window");promise=function(win){return windowStore("helloPromises").getOrSet(win,function(){return new promise_ZalgoPromise})}(promise);return promise=-1!==timeout?promise.timeout(timeout,new Error(name+" did not load after "+timeout+"ms")):promise}function markWindowKnown(win){windowStore("knownWindows").set(win,!0)}function isSerializedType(item){return"object"==typeof item&&null!==item&&"string"==typeof item.__type__}function determineType(val){return void 0===val?"undefined":null===val?"null":Array.isArray(val)?"array":"function"==typeof val?"function":"object"==typeof val?val instanceof Error?"error":"function"==typeof val.then?"promise":"[object RegExp]"==={}.toString.call(val)?"regex":"[object Date]"==={}.toString.call(val)?"date":"object":"string"==typeof val?"string":"number"==typeof val?"number":"boolean"==typeof val?"boolean":void 0}function serializeType(type,val){return{__type__:type,__val__:val}}var SERIALIZER=((_RECEIVE_MESSAGE_TYPE={}).function=function(){},_RECEIVE_MESSAGE_TYPE.error=function(_ref){return serializeType("error",{message:_ref.message,stack:_ref.stack,code:_ref.code,data:_ref.data})},_RECEIVE_MESSAGE_TYPE.promise=function(){},_RECEIVE_MESSAGE_TYPE.regex=function(val){return serializeType("regex",val.source)},_RECEIVE_MESSAGE_TYPE.date=function(val){return serializeType("date",val.toJSON())},_RECEIVE_MESSAGE_TYPE.array=function(val){return val},_RECEIVE_MESSAGE_TYPE.object=function(val){return val},_RECEIVE_MESSAGE_TYPE.string=function(val){return val},_RECEIVE_MESSAGE_TYPE.number=function(val){return val},_RECEIVE_MESSAGE_TYPE.boolean=function(val){return val},_RECEIVE_MESSAGE_TYPE.null=function(val){return val},_RECEIVE_MESSAGE_TYPE),defaultSerializers={},DESERIALIZER=((_RECEIVE_MESSAGE_TYPE={}).function=function(){throw new Error("Function serialization is not implemented; nothing to deserialize")},_RECEIVE_MESSAGE_TYPE.error=function(error){var stack=error.stack,code=error.code,data=error.data,error=new Error(error.message);return error.code=code,data&&(error.data=data),error.stack=stack+"\n\n"+error.stack,error},_RECEIVE_MESSAGE_TYPE.promise=function(){throw new Error("Promise serialization is not implemented; nothing to deserialize")},_RECEIVE_MESSAGE_TYPE.regex=function(val){return new RegExp(val)},_RECEIVE_MESSAGE_TYPE.date=function(val){return new Date(val)},_RECEIVE_MESSAGE_TYPE.array=function(val){return val},_RECEIVE_MESSAGE_TYPE.object=function(val){return val},_RECEIVE_MESSAGE_TYPE.string=function(val){return val},_RECEIVE_MESSAGE_TYPE.number=function(val){return val},_RECEIVE_MESSAGE_TYPE.boolean=function(val){return val},_RECEIVE_MESSAGE_TYPE.null=function(val){return val},_RECEIVE_MESSAGE_TYPE),defaultDeserializers={};function needsBridgeForBrowser(){return!!utils_getUserAgent(window).match(/MSIE|trident|edge\/12|edge\/13/i)}function needsBridgeForWin(win){return!isSameTopWindow(window,win)}function needsBridgeForDomain(domain,win){if(domain){if(getDomain()!==getDomainFromUrl(domain))return!0}else if(win&&!isSameDomain(win))return!0;return!1}function needsBridge(domain){var win=domain.win,domain=domain.domain;return!(!needsBridgeForBrowser()||domain&&!needsBridgeForDomain(domain,win)||win&&!needsBridgeForWin(win))}function getBridgeName(domain){return"__postrobot_bridge___"+(domain=domain||getDomainFromUrl(domain)).replace(/[^a-zA-Z0-9]+/g,"_")}function isBridge(){return Boolean(window.name&&window.name===getBridgeName(getDomain()))}var documentBodyReady=new promise_ZalgoPromise(function(resolve){if(window.document&&window.document.body)return resolve(window.document.body);var interval=setInterval(function(){if(window.document&&window.document.body)return clearInterval(interval),resolve(window.document.body)},10)});function registerRemoteWindow(win){windowStore("remoteWindowPromises").getOrSet(win,function(){return new promise_ZalgoPromise})}function findRemoteWindow(remoteWinPromise){remoteWinPromise=windowStore("remoteWindowPromises").get(remoteWinPromise);if(!remoteWinPromise)throw new Error("Remote window promise not found");return remoteWinPromise}function registerRemoteSendMessage(win,domain,sendMessage){findRemoteWindow(win).resolve(function(remoteWin,remoteDomain,message){if(remoteWin!==win)throw new Error("Remote window does not match window");if(!matchDomain(remoteDomain,domain))throw new Error("Remote domain "+remoteDomain+" does not match domain "+domain);sendMessage.fireAndForget(message)})}function rejectRemoteSendMessage(win,err){findRemoteWindow(win).reject(err).catch(src_util_noop)}function linkWindow(details){for(var win=details.win,name=details.name,domain=details.domain,popupWindowsByName=globalStore("popupWindowsByName"),popupWindowsByWin=windowStore("popupWindowsByWin"),_i2=0,_popupWindowsByName$k2=popupWindowsByName.keys();_i2<_popupWindowsByName$k2.length;_i2++){var winName=_popupWindowsByName$k2[_i2],_details=popupWindowsByName.get(winName);_details&&!isWindowClosed(_details.win)||popupWindowsByName.del(winName)}if(isWindowClosed(win))return{win:win,name:name,domain:domain};details=popupWindowsByWin.getOrSet(win,function(){return name?popupWindowsByName.getOrSet(name,function(){return{win:win,name:name}}):{win:win}});if(details.win&&details.win!==win)throw new Error("Different window already linked for window: "+(name||"undefined"));return name&&(details.name=name,popupWindowsByName.set(name,details)),domain&&(details.domain=domain,registerRemoteWindow(win)),popupWindowsByWin.set(win,details),details}function setupBridge(receiveMessage){var on=receiveMessage.on,send=receiveMessage.send,receiveMessage=receiveMessage.receiveMessage,windowOpen=window.open;window.open=function(url,name,options,win){win=windowOpen.call(this,normalizeMockUrl(url),name,options,win);return win&&(linkWindow({win:win,name:name,domain:url?getDomainFromUrl(url):null}),win)},function(_ref){var on=_ref.on,send=_ref.send,receiveMessage=_ref.receiveMessage,popupWindowsByName=globalStore("popupWindowsByName");on("postrobot_open_tunnel",function(bridgePromise){var source=bridgePromise.source,origin=bridgePromise.origin,data=bridgePromise.data,bridgePromise=globalStore("bridges").get(origin);if(!bridgePromise)throw new Error("Can not find bridge promise for domain "+origin);return bridgePromise.then(function(bridge){if(source!==bridge)throw new Error("Message source does not matched registered bridge for domain "+origin);if(!data.name)throw new Error("Register window expected to be passed window name");if(!data.sendMessage)throw new Error("Register window expected to be passed sendMessage method");if(!popupWindowsByName.has(data.name))throw new Error("Window with name "+data.name+" does not exist, or was not opened by this window");if(!popupWindowsByName.get(data.name).domain)throw new Error("We do not have a registered domain for window "+data.name);if(popupWindowsByName.get(data.name).domain!==origin)throw new Error("Message origin "+origin+" does not matched registered window origin "+popupWindowsByName.get(data.name).domain);return registerRemoteSendMessage(popupWindowsByName.get(data.name).win,origin,data.sendMessage),{sendMessage:function(message){if(window&&!window.closed){var winDetails=popupWindowsByName.get(data.name);if(winDetails)try{receiveMessage({data:message,origin:winDetails.domain,source:winDetails.win},{on:on,send:send})}catch(err){promise_ZalgoPromise.reject(err)}}}}})})}({on:on,send:send,receiveMessage:receiveMessage}),function(_ref2){var send=_ref2.send;global_getGlobal(window).openTunnelToParent=function(parentWindow){var name=parentWindow.name,source=parentWindow.source,canary=parentWindow.canary,sendMessage=parentWindow.sendMessage,tunnelWindows=globalStore("tunnelWindows"),parentWindow=utils_getParent(window);if(!parentWindow)throw new Error("No parent window found to open tunnel to");var id=function(id){var name=id.name,source=id.source,canary=id.canary,sendMessage=id.sendMessage;!function(){for(var tunnelWindows=globalStore("tunnelWindows"),_i2=0,_tunnelWindows$keys2=tunnelWindows.keys();_i2<_tunnelWindows$keys2.length;_i2++){var key=_tunnelWindows$keys2[_i2];isWindowClosed(tunnelWindows[key].source)&&tunnelWindows.del(key)}}();id=uniqueID();return globalStore("tunnelWindows").set(id,{name:name,source:source,canary:canary,sendMessage:sendMessage}),id}({name:name,source:source,canary:canary,sendMessage:sendMessage});return send(parentWindow,"postrobot_open_tunnel",{name:name,sendMessage:function(){var tunnelWindow=tunnelWindows.get(id);if(tunnelWindow&&tunnelWindow.source&&!isWindowClosed(tunnelWindow.source)){try{tunnelWindow.canary()}catch(err){return}tunnelWindow.sendMessage.apply(this,arguments)}}},{domain:"*"})}}({on:on,send:send}),function(_ref){var on=_ref.on,send=_ref.send,receiveMessage=_ref.receiveMessage;promise_ZalgoPromise.try(function(){var win,opener=getOpener(window);if(opener&&needsBridge({win:opener}))return registerRemoteWindow(opener),win=opener,windowStore("remoteBridgeAwaiters").getOrSet(win,function(){return promise_ZalgoPromise.try(function(){var frame=getFrameByName(win,getBridgeName(getDomain()));if(frame)return isSameDomain(frame)&&global_getGlobal(assertSameDomain(frame))?frame:new promise_ZalgoPromise(function(resolve){var interval=setInterval(function(){if(frame&&isSameDomain(frame)&&global_getGlobal(assertSameDomain(frame)))return clearInterval(interval),clearTimeout(timeout),resolve(frame)},100),timeout=setTimeout(function(){return clearInterval(interval),resolve()},2e3)})})}).then(function(bridge){return bridge?window.name?global_getGlobal(assertSameDomain(bridge)).openTunnelToParent({name:window.name,source:window,canary:function(){},sendMessage:function(message){try{window}catch(err){return}if(window&&!window.closed)try{receiveMessage({data:message,origin:this.origin,source:this.source},{on:on,send:send})}catch(err){promise_ZalgoPromise.reject(err)}}}).then(function(data){var source=data.source,origin=data.origin,data=data.data;if(source!==opener)throw new Error("Source does not match opener");registerRemoteSendMessage(source,origin,data.sendMessage)}).catch(function(err){throw rejectRemoteSendMessage(opener,err),err}):rejectRemoteSendMessage(opener,new Error("Can not register with opener: window does not have a name")):rejectRemoteSendMessage(opener,new Error("Can not register with opener: no bridge found in opener"))})})}({on:on,send:send,receiveMessage:receiveMessage})}function cleanupProxyWindows(){for(var idToProxyWindow=globalStore("idToProxyWindow"),_i2=0,_idToProxyWindow$keys2=idToProxyWindow.keys();_i2<_idToProxyWindow$keys2.length;_i2++){var id=_idToProxyWindow$keys2[_i2];idToProxyWindow.get(id).shouldClean()&&idToProxyWindow.del(id)}}function getSerializedWindow(winPromise,id){var method,cache,send=id.send,id=id.id,id=void 0===id?uniqueID():id,windowNamePromise=winPromise.then(function(win){if(isSameDomain(win))return assertSameDomain(win).name});return{id:id,getType:function(){return winPromise.then(function(win){return getOpener(win)?WINDOW_TYPE.POPUP:WINDOW_TYPE.IFRAME})},getInstanceID:(method=function(){return winPromise.then(function(win){return getWindowInstanceID(win,{send:send})})},cache={},memoizedPromiseFunction.reset=function(){cache={}},setFunctionName(memoizedPromiseFunction,getFunctionName(method)+"::promiseMemoized")),close:function(){return winPromise.then(closeWindow)},getName:function(){return winPromise.then(function(win){if(!isWindowClosed(win))return isSameDomain(win)?assertSameDomain(win).name:windowNamePromise})},focus:function(){return winPromise.then(function(win){win.focus()})},isClosed:function(){return winPromise.then(function(win){return isWindowClosed(win)})},setLocation:function(href){return winPromise.then(function(win){if(isSameDomain(win))try{if(win.location&&"function"==typeof win.location.replace)return void win.location.replace(href)}catch(err){}win.location=href})},setName:function(name){return winPromise.then(function(win){linkWindow({win:win,name:name});var sameDomain=isSameDomain(win),frame=function(win){if(isSameDomain(win))return assertSameDomain(win).frameElement;for(var _i21=0,_document$querySelect2=document.querySelectorAll("iframe");_i21<_document$querySelect2.length;_i21++){var frame=_document$querySelect2[_i21];if(frame&&frame.contentWindow&&frame.contentWindow===win)return frame}}(win);if(!sameDomain)throw new Error("Can not set name for cross-domain window: "+name);assertSameDomain(win).name=name,frame&&frame.setAttribute("name",name),windowNamePromise=promise_ZalgoPromise.resolve(name)})}};function memoizedPromiseFunction(){for(var _arguments=arguments,_this2=this,_len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];var key=serializeArgs(args);return cache.hasOwnProperty(key)||(cache[key]=promise_ZalgoPromise.try(function(){return method.apply(_this2,_arguments)}).finally(function(){delete cache[key]})),cache[key]}}var window_ProxyWindow=function(){function ProxyWindow(serializedWindow){var send=serializedWindow.send,win=serializedWindow.win,serializedWindow=serializedWindow.serializedWindow;this.id=void 0,this.isProxyWindow=!0,this.serializedWindow=void 0,this.actualWindow=void 0,this.actualWindowPromise=void 0,this.send=void 0,this.name=void 0,this.actualWindowPromise=new promise_ZalgoPromise,this.serializedWindow=serializedWindow||getSerializedWindow(this.actualWindowPromise,{send:send}),globalStore("idToProxyWindow").set(this.getID(),this),win&&this.setWindow(win,{send:send})}var _proto=ProxyWindow.prototype;return _proto.getID=function(){return this.serializedWindow.id},_proto.getType=function(){return this.serializedWindow.getType()},_proto.isPopup=function(){return this.getType().then(function(type){return type===WINDOW_TYPE.POPUP})},_proto.setLocation=function(href){var _this=this;return this.serializedWindow.setLocation(href).then(function(){return _this})},_proto.getName=function(){return this.serializedWindow.getName()},_proto.setName=function(name){var _this2=this;return this.serializedWindow.setName(name).then(function(){return _this2})},_proto.close=function(){var _this3=this;return this.serializedWindow.close().then(function(){return _this3})},_proto.focus=function(){var _this4=this,reopenPromise=this.isPopup(),focusPromise=this.getName(),reopenPromise=promise_ZalgoPromise.hash({isPopup:reopenPromise,name:focusPromise}).then(function(_ref3){var name=_ref3.name;_ref3.isPopup&&name&&window.open("",name)}),focusPromise=this.serializedWindow.focus();return promise_ZalgoPromise.all([reopenPromise,focusPromise]).then(function(){return _this4})},_proto.isClosed=function(){return this.serializedWindow.isClosed()},_proto.getWindow=function(){return this.actualWindow},_proto.setWindow=function(win,send){send=send.send;this.actualWindow=win,this.actualWindowPromise.resolve(this.actualWindow),this.serializedWindow=getSerializedWindow(this.actualWindowPromise,{send:send,id:this.getID()}),windowStore("winToProxyWindow").set(win,this)},_proto.awaitWindow=function(){return this.actualWindowPromise},_proto.matchWindow=function(win,_ref5){var _this5=this,send=_ref5.send;return promise_ZalgoPromise.try(function(){return _this5.actualWindow?win===_this5.actualWindow:promise_ZalgoPromise.hash({proxyInstanceID:_this5.getInstanceID(),knownWindowInstanceID:getWindowInstanceID(win,{send:send})}).then(function(match){match=match.proxyInstanceID===match.knownWindowInstanceID;return match&&_this5.setWindow(win,{send:send}),match})})},_proto.unwrap=function(){return this.actualWindow||this},_proto.getInstanceID=function(){return this.serializedWindow.getInstanceID()},_proto.shouldClean=function(){return Boolean(this.actualWindow&&isWindowClosed(this.actualWindow))},_proto.serialize=function(){return this.serializedWindow},ProxyWindow.unwrap=function(win){return ProxyWindow.isProxyWindow(win)?win.unwrap():win},ProxyWindow.serialize=function(win,send){send=send.send;return cleanupProxyWindows(),ProxyWindow.toProxyWindow(win,{send:send}).serialize()},ProxyWindow.deserialize=function(serializedWindow,send){send=send.send;return cleanupProxyWindows(),globalStore("idToProxyWindow").get(serializedWindow.id)||new ProxyWindow({serializedWindow:serializedWindow,send:send})},ProxyWindow.isProxyWindow=function(obj){return Boolean(obj&&!isWindow(obj)&&obj.isProxyWindow)},ProxyWindow.toProxyWindow=function(actualWindow,send){send=send.send;if(cleanupProxyWindows(),ProxyWindow.isProxyWindow(actualWindow))return actualWindow;return windowStore("winToProxyWindow").get(actualWindow)||new ProxyWindow({win:actualWindow,send:send})},ProxyWindow}();function addMethod(id,val,name,source,domain){var methodStore=windowStore("methodStore"),proxyWindowMethods=globalStore("proxyWindowMethods");window_ProxyWindow.isProxyWindow(source)?proxyWindowMethods.set(id,{val:val,name:name,domain:domain,source:source}):(proxyWindowMethods.del(id),methodStore.getOrSet(source,function(){return{}})[id]={domain:domain,name:name,val:val,source:source})}function lookupMethod(source,id){var methodStore=windowStore("methodStore"),proxyWindowMethods=globalStore("proxyWindowMethods");return methodStore.getOrSet(source,function(){return{}})[id]||proxyWindowMethods.get(id)}function function_serializeFunction(destination,domain,val,key,_ref){var on=(_ref={on:_ref.on,send:_ref.send}).on,send=_ref.send;globalStore("builtinListeners").getOrSet("functionCalls",function(){return on("postrobot_method",{domain:"*"},function(_ref2){var source=_ref2.source,origin=_ref2.origin,data=_ref2.data,id=data.id,name=data.name,meth=lookupMethod(source,id);if(!meth)throw new Error("Could not find method '"+name+"' with id: "+data.id+" in "+getDomain(window));var methodSource=meth.source,domain=meth.domain,val=meth.val;return promise_ZalgoPromise.try(function(){if(!matchDomain(domain,origin))throw new Error("Method '"+data.name+"' domain "+JSON.stringify(util_isRegex(meth.domain)?meth.domain.source:meth.domain)+" does not match origin "+origin+" in "+getDomain(window));if(window_ProxyWindow.isProxyWindow(methodSource))return methodSource.matchWindow(source,{send:send}).then(function(match){if(!match)throw new Error("Method call '"+data.name+"' failed - proxy window does not match source in "+getDomain(window))})}).then(function(){return val.apply({source:source,origin:origin},data.args)},function(err){return promise_ZalgoPromise.try(function(){if(val.onError)return val.onError(err)}).then(function(){var args;throw err.stack&&(err.stack="Remote call to "+name+"("+arrayFrom(args=void 0===(args=data.args)?[]:args).map(function(arg){return"string"==typeof arg?"'"+arg+"'":void 0===arg?"undefined":null===arg?"null":"boolean"==typeof arg?arg.toString():Array.isArray(arg)?"[ ... ]":"object"==typeof arg?"{ ... }":"function"==typeof arg?"() => { ... }":"<"+typeof arg+">"}).join(", ")+") failed\n\n"+err.stack),err})}).then(function(result){return{result:result,id:id,name:name}})})});var id=val.__id__||uniqueID();destination=window_ProxyWindow.unwrap(destination);var name=val.__name__||val.name||key;return"string"==typeof name&&"function"==typeof name.indexOf&&0===name.indexOf("anonymous::")&&(name=name.replace("anonymous::",key+"::")),window_ProxyWindow.isProxyWindow(destination)?(addMethod(id,val,name,destination,domain),destination.awaitWindow().then(function(win){addMethod(id,val,name,win,domain)})):addMethod(id,val,name,destination,domain),serializeType("cross_domain_function",{id:id,name:name})}function serializeMessage(destination,domain,_serialize,_ref){var on=_ref.on,send=_ref.send;return function(result,serializers){void 0===serializers&&(serializers=defaultSerializers);result=JSON.stringify(result,function(key){var val=this[key];if(isSerializedType(this))return val;var serializer=determineType(val);if(!serializer)return val;serializer=serializers[serializer]||SERIALIZER[serializer];return serializer?serializer(val,key):val});return void 0===result?"undefined":result}(_serialize,((_serialize={}).promise=function(val,key){return function(destination,domain,val,key,_ref){return serializeType("cross_domain_zalgo_promise",{then:function_serializeFunction(destination,domain,function(resolve,reject){return val.then(resolve,reject)},key,{on:_ref.on,send:_ref.send})})}(destination,domain,val,key,{on:on,send:send})},_serialize.function=function(val,key){return function_serializeFunction(destination,domain,val,key,{on:on,send:send})},_serialize.object=function(val){return isWindow(val)||window_ProxyWindow.isProxyWindow(val)?serializeType("cross_domain_window",window_ProxyWindow.serialize(val,{send:send})):val},_serialize))}function deserializeMessage(source,origin,_deserialize,_ref2){var on=_ref2.on,send=_ref2.send;return function(str,deserializers){if(void 0===deserializers&&(deserializers=defaultDeserializers),"undefined"!==str)return JSON.parse(str,function(key,value){if(isSerializedType(this))return value;value=isSerializedType(value)?(deserializer=value.__type__,value.__val__):(deserializer=determineType(value),value);if(!deserializer)return value;var deserializer=deserializers[deserializer]||DESERIALIZER[deserializer];return deserializer?deserializer(value,key):value})}(_deserialize,((_deserialize={}).cross_domain_zalgo_promise=function(serializedPromise){return new promise_ZalgoPromise(serializedPromise.then)},_deserialize.cross_domain_function=function(serializedFunction){return function(source,origin,crossDomainFunctionWrapper){function getDeserializedFunction(opts){function crossDomainFunctionWrapper(){var _arguments=arguments;return window_ProxyWindow.toProxyWindow(source,{send:send}).awaitWindow().then(function(win){var _args=lookupMethod(win,id);if(_args&&_args.val!==crossDomainFunctionWrapper)return _args.val.apply({source:window,origin:getDomain()},_arguments);var options={domain:origin,fireAndForget:opts.fireAndForget},_args=[].slice.call(_arguments);return send(win,"postrobot_method",{id:id,name:name,args:_args},options).then(function(res){if(!opts.fireAndForget)return res.data.result})}).catch(function(err){throw err})}return void 0===opts&&(opts={}),crossDomainFunctionWrapper.__name__=name,crossDomainFunctionWrapper.__origin__=origin,crossDomainFunctionWrapper.__source__=source,crossDomainFunctionWrapper.__id__=id,crossDomainFunctionWrapper.origin=origin,crossDomainFunctionWrapper}var id=serializedFunction.id,name=serializedFunction.name,send=crossDomainFunctionWrapper.send,crossDomainFunctionWrapper=getDeserializedFunction();return crossDomainFunctionWrapper.fireAndForget=getDeserializedFunction({fireAndForget:!0}),crossDomainFunctionWrapper}(source,origin,{on:on,send:send})},_deserialize.cross_domain_window=function(serializedWindow){return window_ProxyWindow.deserialize(serializedWindow,{send:send})},_deserialize))}var SEND_MESSAGE_STRATEGIES={};function send_sendMessage(win,domain,message,_serializeMessage){var on=_serializeMessage.on,send=_serializeMessage.send;if(isWindowClosed(win))throw new Error("Window is closed");for(var serializedMessage=serializeMessage(win,domain,((_serializeMessage={}).__post_robot_10_0_31__=_extends({id:uniqueID(),origin:getDomain(window)},message),_serializeMessage),{on:on,send:send}),strategies=Object.keys(SEND_MESSAGE_STRATEGIES),errors=[],_i2=0;_i2<strategies.length;_i2++){var strategyName=strategies[_i2];try{SEND_MESSAGE_STRATEGIES[strategyName](win,serializedMessage,domain)}catch(err){errors.push(err)}}if(errors.length===strategies.length)throw new Error("All post-robot messaging strategies failed:\n\n"+errors.map(function(err,i){return i+". "+stringifyError(err)}).join("\n\n"))}function getResponseListener(hash){return globalStore("responseListeners").get(hash)}function deleteResponseListener(hash){globalStore("responseListeners").del(hash)}function isResponseListenerErrored(hash){return globalStore("erroredResponseListeners").has(hash)}function getRequestListener(_ref){var name=_ref.name,win=_ref.win,domain=_ref.domain,requestListeners=windowStore("requestListeners");if("*"===win&&(win=null),"*"===domain&&(domain=null),!name)throw new Error("Name required to get request listener");for(var _i4=0,_ref3=[win,getWildcard()];_i4<_ref3.length;_i4++){var domainListeners=_ref3[_i4];if(domainListeners){domainListeners=requestListeners.get(domainListeners);if(domainListeners){domainListeners=domainListeners[name];if(domainListeners){if(domain&&"string"==typeof domain){if(domainListeners[domain])return domainListeners[domain];if(domainListeners.__domain_regex__)for(var _i6=0,_domainListeners$__DO2=domainListeners.__domain_regex__;_i6<_domainListeners$__DO2.length;_i6++){var _domainListeners$__DO3=_domainListeners$__DO2[_i6],listener=_domainListeners$__DO3.listener;if(matchDomain(_domainListeners$__DO3.regex,domain))return listener}}if(domainListeners["*"])return domainListeners["*"]}}}}}SEND_MESSAGE_STRATEGIES.postrobot_post_message=function(win,serializedMessage,domain){(Array.isArray(domain)?domain:"string"==typeof domain?[domain]:["*"]).map(function(dom){return 0===dom.indexOf("file:")?"*":dom}).forEach(function(dom){win.postMessage(serializedMessage,dom)})},SEND_MESSAGE_STRATEGIES.postrobot_bridge=function(win,serializedMessage,domain){if(!needsBridgeForBrowser()&&!isBridge())throw new Error("Bridge not needed for browser");if(isSameDomain(win))throw new Error("Post message through bridge disabled between same domain windows");if(!1!==isSameTopWindow(window,win))throw new Error("Can only use bridge to communicate between two different windows, not between frames");!function(win,domain,message){var messagingChild=isOpener(window,win),messagingParent=isOpener(win,window);if(!messagingChild&&!messagingParent)throw new Error("Can only send messages to and from parent and popup windows");findRemoteWindow(win).then(function(sendMessage){return sendMessage(win,domain,message)})}(win,domain,serializedMessage)},SEND_MESSAGE_STRATEGIES.postrobot_global=function(foreignGlobal,serializedMessage){if(!utils_getUserAgent(window).match(/MSIE|rv:11|trident|edge\/12|edge\/13/i))throw new Error("Global messaging not needed for browser");if(!isSameDomain(foreignGlobal))throw new Error("Post message through global disabled between different domain windows");if(!1!==isSameTopWindow(window,foreignGlobal))throw new Error("Can only use global to communicate between two different windows, not between frames");foreignGlobal=global_getGlobal(foreignGlobal);if(!foreignGlobal)throw new Error("Can not find postRobot global on foreign window");foreignGlobal.receiveMessage({source:window,origin:getDomain(),data:serializedMessage})};var RECEIVE_MESSAGE_TYPES=((_RECEIVE_MESSAGE_TYPE={}).postrobot_message_request=function(source,origin,message,_ref){var on=_ref.on,send=_ref.send,options=getRequestListener({name:message.name,win:source,domain:origin}),logName="postrobot_method"===message.name&&message.data&&"string"==typeof message.data.name?message.data.name+"()":message.name;function sendResponse(type,ack,response){if(void 0===response&&(response={}),!message.fireAndForget&&!isWindowClosed(source))try{send_sendMessage(source,origin,_extends({type:type,ack:ack,hash:message.hash,name:message.name},response),{on:on,send:send})}catch(err){throw new Error("Send response message failed for "+logName+" in "+getDomain()+"\n\n"+stringifyError(err))}}return promise_ZalgoPromise.all([sendResponse("postrobot_message_ack"),promise_ZalgoPromise.try(function(){if(!options)throw new Error("No handler found for post message: "+message.name+" from "+origin+" in "+window.location.protocol+"//"+window.location.hostname+window.location.pathname);if(!matchDomain(options.domain,origin))throw new Error("Request origin "+origin+" does not match domain "+options.domain.toString());return options.handler({source:source,origin:origin,data:message.data})}).then(function(data){return sendResponse("postrobot_message_response","success",{data:data})},function(error){return sendResponse("postrobot_message_response","error",{error:error})})]).then(src_util_noop).catch(function(err){if(options&&options.handleError)return options.handleError(err);throw err})},_RECEIVE_MESSAGE_TYPE.postrobot_message_ack=function(source,origin,message){if(!isResponseListenerErrored(message.hash)){var options=getResponseListener(message.hash);if(!options)throw new Error("No handler found for post message ack for message: "+message.name+" from "+origin+" in "+window.location.protocol+"//"+window.location.hostname+window.location.pathname);try{if(!matchDomain(options.domain,origin))throw new Error("Ack origin "+origin+" does not match domain "+options.domain.toString());if(source!==options.win)throw new Error("Ack source does not match registered window")}catch(err){options.promise.reject(err)}options.ack=!0}},_RECEIVE_MESSAGE_TYPE.postrobot_message_response=function(source,origin,message){if(!isResponseListenerErrored(message.hash)){var pattern,options=getResponseListener(message.hash);if(!options)throw new Error("No handler found for post message response for message: "+message.name+" from "+origin+" in "+window.location.protocol+"//"+window.location.hostname+window.location.pathname);if(!matchDomain(options.domain,origin))throw new Error("Response origin "+origin+" does not match domain "+(pattern=options.domain,Array.isArray(pattern)?"("+pattern.join(" | ")+")":isRegex(pattern)?"RegExp("+pattern.toString():pattern.toString()));if(source!==options.win)throw new Error("Response source does not match registered window");deleteResponseListener(message.hash),"error"===message.ack?options.promise.reject(message.error):"success"===message.ack&&options.promise.resolve({source:source,origin:origin,data:message.data})}},_RECEIVE_MESSAGE_TYPE);function receive_receiveMessage(message,origin){var on=origin.on,send=origin.send,receivedMessages=globalStore("receivedMessages");try{if(!window||window.closed||!message.source)return}catch(err){return}var source=message.source,origin=message.origin,message=function(message,source,origin,send){var parsedMessage,on=send.on,send=send.send;try{parsedMessage=deserializeMessage(source,origin,message,{on:on,send:send})}catch(err){return}if(parsedMessage&&"object"==typeof parsedMessage&&null!==parsedMessage&&(parsedMessage=parsedMessage.__post_robot_10_0_31__)&&"object"==typeof parsedMessage&&null!==parsedMessage&&parsedMessage.type&&"string"==typeof parsedMessage.type&&RECEIVE_MESSAGE_TYPES[parsedMessage.type])return parsedMessage}(message.data,source,origin,{on:on,send:send});message&&(markWindowKnown(source),receivedMessages.has(message.id)||(receivedMessages.set(message.id,!0),isWindowClosed(source)&&!message.fireAndForget||(0===message.origin.indexOf("file:")&&(origin="file://"),RECEIVE_MESSAGE_TYPES[message.type](source,origin,message,{on:on,send:send}))))}function on_on(name,options,domain){if(!name)throw new Error("Expected name");if("function"==typeof options&&(domain=options,options={}),!domain)throw new Error("Expected handler");(options=options||{}).name=name,options.handler=domain||options.handler;var win=options.window,domain=options.domain,requestListener=function addRequestListener(existingListener,listener){var name=existingListener.name,win=existingListener.win,domain=existingListener.domain,requestListeners=windowStore("requestListeners");if(!name||"string"!=typeof name)throw new Error("Name required to add request listener");if(Array.isArray(win)){for(var listenersCollection=[],_i8=0,_win2=win;_i8<_win2.length;_i8++)listenersCollection.push(addRequestListener({name:name,domain:domain,win:_win2[_i8]},listener));return{cancel:function(){for(var _i10=0;_i10<listenersCollection.length;_i10++)listenersCollection[_i10].cancel()}}}if(Array.isArray(domain)){for(var _listenersCollection=[],_i12=0,_domain2=domain;_i12<_domain2.length;_i12++)_listenersCollection.push(addRequestListener({name:name,win:win,domain:_domain2[_i12]},listener));return{cancel:function(){for(var _i14=0;_i14<_listenersCollection.length;_i14++)_listenersCollection[_i14].cancel()}}}existingListener=getRequestListener({name:name,win:win,domain:domain});if(win&&"*"!==win||(win=getWildcard()),domain=domain||"*",existingListener)throw win&&domain?new Error("Request listener already exists for "+name+" on domain "+domain.toString()+" for "+(win===getWildcard()?"wildcard":"specified")+" window"):win?new Error("Request listener already exists for "+name+" for "+(win===getWildcard()?"wildcard":"specified")+" window"):domain?new Error("Request listener already exists for "+name+" on domain "+domain.toString()):new Error("Request listener already exists for "+name);var regexListeners,regexListener,nameListeners=requestListeners.getOrSet(win,function(){return{}}),domainListeners=util_getOrSet(nameListeners,name,function(){return{}}),strDomain=domain.toString();return util_isRegex(domain)?(regexListeners=util_getOrSet(domainListeners,"__domain_regex__",function(){return[]})).push(regexListener={regex:domain,listener:listener}):domainListeners[strDomain]=listener,{cancel:function(){delete domainListeners[strDomain],regexListener&&(regexListeners.splice(regexListeners.indexOf(regexListener,1)),regexListeners.length||delete domainListeners.__domain_regex__),Object.keys(domainListeners).length||delete nameListeners[name],win&&!Object.keys(nameListeners).length&&requestListeners.del(win)}}}({name:name,win:win,domain:domain},{handler:options.handler,handleError:options.errorHandler||function(err){throw err},window:win,domain:domain||"*",name:name});return{cancel:function(){requestListener.cancel()}}}var send_send=function send(win,name,data,options){var domain=(options=options||{}).domain||"*",responseTimeout=options.timeout||-1,childTimeout=options.timeout||5e3,fireAndForget=options.fireAndForget||!1;return promise_ZalgoPromise.try(function(){if(!function(name,win,domain){if(!name)throw new Error("Expected name");if(domain&&"string"!=typeof domain&&!Array.isArray(domain)&&!util_isRegex(domain))throw new TypeError("Expected domain to be a string, array, or regex");if(isWindowClosed(win))throw new Error("Target window is closed")}(name,win,domain),function(parent,child){var actualParent=getAncestor(child);if(actualParent)return actualParent===parent;if(child!==parent&&getTop(child)!==child)for(var _i15=0,_getFrames8=getFrames(parent);_i15<_getFrames8.length;_i15++)if(_getFrames8[_i15]===child)return 1}(window,win))return awaitWindowHello(win,childTimeout)}).then(function(_temp){return function(win,targetDomain,actualDomain,_ref){var send=_ref.send;return"string"==typeof targetDomain?promise_ZalgoPromise.resolve(targetDomain):promise_ZalgoPromise.try(function(){return actualDomain||sayHello(win,{send:send}).then(function(_ref2){return _ref2.domain})}).then(function(normalizedDomain){if(!matchDomain(targetDomain,targetDomain))throw new Error("Domain "+stringify(targetDomain)+" does not match "+stringify(targetDomain));return normalizedDomain})}(win,domain,(void 0===_temp?{}:_temp).domain,{send:send})}).then(function(targetDomain){domain=targetDomain;var responseListener,reqPromises,totalAckTimeout,totalResTimeout,ackTimeout,resTimeout,interval,logName="postrobot_method"===name&&data&&"string"==typeof data.name?data.name+"()":name,promise=new promise_ZalgoPromise,hash=name+"_"+uniqueID();fireAndForget||(function(hash,listener){globalStore("responseListeners").set(hash,listener)}(hash,responseListener={name:name,win:win,domain:domain,promise:promise}),(reqPromises=windowStore("requestPromises").getOrSet(win,function(){return[]})).push(promise),promise.catch(function(){!function(hash){globalStore("erroredResponseListeners").set(hash,!0)}(hash),deleteResponseListener(hash)}),totalAckTimeout=function(win){return windowStore("knownWindows").get(win,!1)}(win)?1e4:2e3,ackTimeout=totalAckTimeout,resTimeout=totalResTimeout=responseTimeout,interval=safeInterval(function(){return isWindowClosed(win)?promise.reject(new Error("Window closed for "+name+" before "+(responseListener.ack?"response":"ack"))):responseListener.cancelled?promise.reject(new Error("Response listener was cancelled for "+name)):(ackTimeout=Math.max(ackTimeout-500,0),-1!==resTimeout&&(resTimeout=Math.max(resTimeout-500,0)),responseListener.ack||0!==ackTimeout?0===resTimeout&&promise.reject(new Error("No response for postMessage "+logName+" in "+getDomain()+" in "+totalResTimeout+"ms")):promise.reject(new Error("No ack for postMessage "+logName+" in "+getDomain()+" in "+totalAckTimeout+"ms")))},500),promise.finally(function(){interval.cancel(),reqPromises.splice(reqPromises.indexOf(promise,1))}).catch(src_util_noop));try{send_sendMessage(win,domain,{type:"postrobot_message_request",hash:hash,name:name,data:data,fireAndForget:fireAndForget},{on:on_on,send:send})}catch(err){throw new Error("Send request message failed for "+logName+" in "+getDomain()+"\n\n"+stringifyError(err))}return fireAndForget?promise.resolve():promise})};function setup_serializeMessage(destination,domain,obj){return serializeMessage(destination,domain,obj,{on:on_on,send:send_send})}function setup_deserializeMessage(source,origin,message){return deserializeMessage(source,origin,message,{on:on_on,send:send_send})}function setup_toProxyWindow(win){return window_ProxyWindow.toProxyWindow(win,{send:send_send})}function cleanUpWindow(win){for(var _i2=0,_requestPromises$get2=windowStore("requestPromises").get(win,[]);_i2<_requestPromises$get2.length;_i2++)_requestPromises$get2[_i2].reject(new Error("Window "+(isWindowClosed(win)?"closed":"cleaned up")+" before response")).catch(src_util_noop)}function lib_global_getGlobal(win){if(!isSameDomain(win=void 0===win?window:win))throw new Error("Can not get global for window on different domain");return win.__zoid_9_0_43__||(win.__zoid_9_0_43__={}),win.__zoid_9_0_43__}function getProxyObject(obj){return{get:function(){var _this=this;return promise_ZalgoPromise.try(function(){if(_this.source&&_this.source!==window)throw new Error("Can not call get on proxy object from a remote window");return obj})}}}var src_bridge={setupBridge:setupBridge,openBridge:function(url,domain){var bridges=globalStore("bridges"),bridgeFrames=globalStore("bridgeFrames");return domain=domain||getDomainFromUrl(url),bridges.getOrSet(domain,function(){return promise_ZalgoPromise.try(function(){if(getDomain()===domain)throw new Error("Can not open bridge on the same domain as current domain: "+domain);var name=getBridgeName(domain);if(getFrameByName(window,name))throw new Error("Frame with name "+name+" already exists on page");var iframe=function(name,url){var iframe=document.createElement("iframe");return iframe.setAttribute("name",name),iframe.setAttribute("id",name),iframe.setAttribute("style","display: none; margin: 0; padding: 0; border: 0px none; overflow: hidden;"),iframe.setAttribute("frameborder","0"),iframe.setAttribute("border","0"),iframe.setAttribute("scrolling","no"),iframe.setAttribute("allowTransparency","true"),iframe.setAttribute("tabindex","-1"),iframe.setAttribute("hidden","true"),iframe.setAttribute("title",""),iframe.setAttribute("role","presentation"),iframe.src=url,iframe}(name,url);return bridgeFrames.set(domain,iframe),documentBodyReady.then(function(body){body.appendChild(iframe);var bridge=iframe.contentWindow;return new promise_ZalgoPromise(function(resolve,reject){iframe.addEventListener("load",resolve),iframe.addEventListener("error",reject)}).then(function(){return awaitWindowHello(bridge,5e3,"Bridge "+url)}).then(function(){return bridge})})})})},linkWindow:linkWindow,linkUrl:function(win,url){linkWindow({win:win,domain:getDomainFromUrl(url)})},isBridge:isBridge,needsBridge:needsBridge,needsBridgeForBrowser:needsBridgeForBrowser,hasBridge:function(url,domain){return globalStore("bridges").has(domain||getDomainFromUrl(url))},needsBridgeForWin:needsBridgeForWin,needsBridgeForDomain:needsBridgeForDomain,destroyBridges:function(){for(var bridges=globalStore("bridges"),bridgeFrames=globalStore("bridgeFrames"),_i4=0,_bridgeFrames$keys2=bridgeFrames.keys();_i4<_bridgeFrames$keys2.length;_i4++){var frame=bridgeFrames.get(_bridgeFrames$keys2[_i4]);frame&&frame.parentNode&&frame.parentNode.removeChild(frame)}bridgeFrames.reset(),bridges.reset()}},PROP_TYPE={STRING:"string",OBJECT:"object",FUNCTION:"function",BOOLEAN:"boolean",NUMBER:"number",ARRAY:"array"},PROP_SERIALIZATION={JSON:"json",DOTIFY:"dotify",BASE64:"base64"},CONTEXT=WINDOW_TYPE,EVENT={RENDER:"zoid-render",RENDERED:"zoid-rendered",DISPLAY:"zoid-display",ERROR:"zoid-error",CLOSE:"zoid-close",DESTROY:"zoid-destroy",PROPS:"zoid-props",RESIZE:"zoid-resize",FOCUS:"zoid-focus"};function normalizeChildProp(propsDef,props,prop,value,helpers){if(!propsDef.hasOwnProperty(prop))return value;prop=propsDef[prop];return"function"==typeof prop.childDecorate?prop.childDecorate({value:value,close:helpers.close,focus:helpers.focus,onError:helpers.onError,onProps:helpers.onProps,resize:helpers.resize,getParent:helpers.getParent,getParentDomain:helpers.getParentDomain,show:helpers.show,hide:helpers.hide}):value}function parseChildWindowName(windowName){return inlineMemoize(parseChildWindowName,function(){if(!windowName)throw new Error("No window name");var encodedPayload=windowName.split("__"),zoidcomp=encodedPayload[1],name=encodedPayload[2],encodedPayload=encodedPayload[3];if("zoid"!==zoidcomp)throw new Error("Window not rendered by zoid - got "+zoidcomp);if(!name)throw new Error("Expected component name");if(!encodedPayload)throw new Error("Expected encoded payload");try{return JSON.parse(function(str){if("function"==typeof atob)return decodeURIComponent([].map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""));if("undefined"!=typeof Buffer)return Buffer.from(str,"base64").toString("utf8");throw new Error("Can not find window.atob or Buffer")}(encodedPayload))}catch(err){throw new Error("Can not decode window name payload: "+encodedPayload+": "+stringifyError(err))}},[windowName])}function getChildPayload(){try{return parseChildWindowName(window.name)}catch(err){}}function child_focus(){return promise_ZalgoPromise.try(function(){window.focus()})}function child_destroy(){return promise_ZalgoPromise.try(function(){window.close()})}function parentComponent(options,overrides,parentWin){void 0===overrides&&(overrides={}),void 0===parentWin&&(parentWin=window);function getPropsForChild(domain){for(var result={},_i2=0,_Object$keys2=Object.keys(props);_i2<_Object$keys2.length;_i2++){var key=_Object$keys2[_i2],prop=propsDef[key];prop&&!1===prop.sendToChild||prop&&prop.sameDomain&&!matchDomain(domain,getDomain(window))||(result[key]=props[key])}return result}function getProxyWindow(){return getProxyWindowOverride?getProxyWindowOverride():promise_ZalgoPromise.try(function(){var windowProp=props.window;if(windowProp){var _proxyWin=setup_toProxyWindow(windowProp);return clean.register(function(){return windowProp.close()}),_proxyWin}return new window_ProxyWindow({send:send_send})})}function getProxyContainer(container){return getProxyContainerOverride?getProxyContainerOverride(container):promise_ZalgoPromise.try(function(){return id=container,new promise_ZalgoPromise(function(resolve,reject){var name=stringify(id),el=getElementSafe(id);if(el)return resolve(el);if(isDocumentReady())return reject(new Error("Document is ready and element "+name+" does not exist"));var interval=setInterval(function(){return(el=getElementSafe(id))?(clearInterval(interval),resolve(el)):isDocumentReady()?(clearInterval(interval),reject(new Error("Document is ready and element "+name+" does not exist"))):void 0},10)});var id}).then(function(containerElement){return getProxyObject(containerElement=isShadowElement(containerElement)?function(element){var shadowHost=function(shadowRoot){shadowRoot=function(element){for(;element.parentNode;)element=element.parentNode;if(isShadowElement(element))return element}(shadowRoot);if(shadowRoot.host)return shadowRoot.host}(element);if(!shadowHost)throw new Error("Element is not in shadow dom");if(isShadowElement(shadowHost))throw new Error("Host element is also in shadow dom");var slotName="shadow-slot-"+uniqueID(),slotProvider=document.createElement("slot");slotProvider.setAttribute("name",slotName),element.appendChild(slotProvider);slotProvider=document.createElement("div");return slotProvider.setAttribute("slot",slotName),shadowHost.appendChild(slotProvider),slotProvider}(containerElement):containerElement)})}function setProxyWin(proxyWin){return setProxyWinOverride?setProxyWinOverride(proxyWin):promise_ZalgoPromise.try(function(){currentProxyWin=proxyWin})}function show(){return showOverride?showOverride():promise_ZalgoPromise.try(function(){if(visible=!0,currentProxyContainer)return currentProxyContainer.get().then(showElement)})}function hide(){return hideOverride?hideOverride():promise_ZalgoPromise.try(function(){if(visible=!1,currentProxyContainer)return currentProxyContainer.get().then(hideElement)})}function getUrl(){return"function"==typeof url?url({props:props}):url}function getChildDomain(){return domainMatch&&"string"==typeof domainMatch?domainMatch:getDomainFromUrl(getUrl())}function getDomainMatcher(){return domainMatch&&util_isRegex(domainMatch)?domainMatch:getChildDomain()}function openFrame(context,_ref){var windowName=_ref.windowName;return openFrameOverride?openFrameOverride(context,{windowName:windowName}):promise_ZalgoPromise.try(function(){if(context===CONTEXT.IFRAME)return getProxyObject(dom_iframe({attributes:_extends({name:windowName,title:name},attributes.iframe)}))})}function openPrerenderFrame(context){return openPrerenderFrameOverride?openPrerenderFrameOverride(context):promise_ZalgoPromise.try(function(){if(context===CONTEXT.IFRAME)return getProxyObject(dom_iframe({attributes:_extends({name:"__zoid_prerender_frame__"+name+"_"+uniqueID()+"__",title:"prerender__"+name},attributes.iframe)}))})}function openPrerender(context,proxyWin,proxyPrerenderFrame){return openPrerenderOverride?openPrerenderOverride(context,proxyWin,proxyPrerenderFrame):promise_ZalgoPromise.try(function(){if(context===CONTEXT.IFRAME){if(!proxyPrerenderFrame)throw new Error("Expected proxy frame to be passed");return proxyPrerenderFrame.get().then(function(prerenderFrame){return clean.register(function(){return destroyElement(prerenderFrame)}),awaitFrameWindow(prerenderFrame).then(assertSameDomain).then(setup_toProxyWindow)})}if(context===CONTEXT.POPUP)return proxyWin;throw new Error("No render context available for "+context)})}function focus(){return promise_ZalgoPromise.try(function(){if(currentProxyWin)return promise_ZalgoPromise.all([event.trigger(EVENT.FOCUS),currentProxyWin.focus()]).then(src_util_noop)})}function initChild(childExports){return promise_ZalgoPromise.try(function(){childComponent=childExports,initPromise.resolve(),clean.register(function(){return childExports.close.fireAndForget().catch(src_util_noop)})})}function resize(_ref2){var width=_ref2.width,height=_ref2.height;return promise_ZalgoPromise.try(function(){event.trigger(EVENT.RESIZE,{width:width,height:height})})}function destroy(err){return promise_ZalgoPromise.try(function(){return event.trigger(EVENT.DESTROY)}).catch(src_util_noop).then(function(){return clean.all()}).then(function(){initPromise.asyncReject(err||new Error("Component destroyed"))})}function close(){return closeOverride?closeOverride():promise_ZalgoPromise.try(function(){return event.trigger(EVENT.CLOSE)}).then(function(){return destroy(new Error("Window closed"))})}function open(context,_ref3){var proxyWin=_ref3.proxyWin,proxyFrame=_ref3.proxyFrame,windowName=_ref3.windowName;return openOverride?openOverride(context,{proxyWin:proxyWin,proxyFrame:proxyFrame,windowName:windowName}):promise_ZalgoPromise.try(function(){if(context===CONTEXT.IFRAME){if(!proxyFrame)throw new Error("Expected proxy frame to be passed");return proxyFrame.get().then(function(frame){return awaitFrameWindow(frame).then(function(win){var element,handler,interval,frameWatcher=(element=frame,handler=once(handler=close),isElementClosed(element)?handler():interval=safeInterval(function(){isElementClosed(element)&&(interval.cancel(),handler())},50),{cancel:function(){interval&&interval.cancel()}});return clean.register(function(){return frameWatcher.cancel()}),clean.register(function(){return destroyElement(frame)}),clean.register(function(){return cleanUpWindow(win)}),win})})}if(context!==CONTEXT.POPUP)throw new Error("No render context available for "+context);var width=dimensions.width,height=dimensions.height,width=normalizeDimension(width,window.outerWidth),height=normalizeDimension(height,window.outerWidth),win=function(options){var name=(options=options||{}).width,params=options.height,top=0,left=0;name&&(window.outerWidth?left=Math.round((window.outerWidth-name)/2)+window.screenX:window.screen.width&&(left=Math.round((window.screen.width-name)/2))),params&&(window.outerHeight?top=Math.round((window.outerHeight-params)/2)+window.screenY:window.screen.height&&(top=Math.round((window.screen.height-params)/2)));name=(options=name&&params?_extends({top:top,left:left,width:name,height:params,status:1,toolbar:0,menubar:0,resizable:1,scrollbars:1},options):options).name||"";delete options.name;var win,params=Object.keys(options).map(function(key){if(null!=options[key])return key+"="+stringify(options[key])}).filter(Boolean).join(",");try{(win=window.open("",name,params,!0)).opener=null}catch(err){throw new PopupOpenError("Can not open popup window - "+(err.stack||err.message))}if(isWindowClosed(win))throw new PopupOpenError("Can not open popup window - blocked");return window.addEventListener("unload",function(){return win.close()}),win}(_extends({name:windowName,width:width,height:height},attributes.popup));return clean.register(function(){return closeWindow(win)}),clean.register(function(){return cleanUpWindow(win)}),win}).then(function(win){return proxyWin.setWindow(win,{send:send_send}),proxyWin})}function watchForUnload(){return promise_ZalgoPromise.try(function(){var unloadWindowListener=addEventListener(window,"unload",once(function(){destroy(new Error("Window navigated away"))})),closeParentWindowListener=onCloseWindow(parentWin,destroy,3e3);if(clean.register(closeParentWindowListener.cancel),clean.register(unloadWindowListener.cancel),watchForUnloadOverride)return watchForUnloadOverride()})}function checkWindowClose(proxyWin){var closed=!1;return proxyWin.isClosed().then(function(isClosed){return isClosed?(closed=!0,close()):promise_ZalgoPromise.delay(200).then(function(){return proxyWin.isClosed()}).then(function(secondIsClosed){if(secondIsClosed)return closed=!0,close()})}).then(function(){return closed})}function onError(err){return onErrorOverride?onErrorOverride(err):promise_ZalgoPromise.try(function(){if(-1===handledErrors.indexOf(err))return handledErrors.push(err),initPromise.asyncReject(err),event.trigger(EVENT.ERROR,err)})}var triggered,handlers,currentProxyWin,currentProxyContainer,childComponent,propsDef=options.propsDef,containerTemplate=options.containerTemplate,prerenderTemplate=options.prerenderTemplate,tag=options.tag,name=options.name,attributes=options.attributes,dimensions=options.dimensions,autoResize=options.autoResize,url=options.url,domainMatch=options.domain,initPromise=new promise_ZalgoPromise,handledErrors=[],clean=cleanup(),state={},event=overrides.event||(triggered={},handlers={},{on:function(eventName,handler){var handlerList=handlers[eventName]=handlers[eventName]||[];handlerList.push(handler);var cancelled=!1;return{cancel:function(){cancelled||(cancelled=!0,handlerList.splice(handlerList.indexOf(handler),1))}}},once:function(eventName,handler){var listener=this.on(eventName,function(){listener.cancel(),handler()});return listener},trigger:function(eventName){for(var _len3=arguments.length,args=new Array(1<_len3?_len3-1:0),_key3=1;_key3<_len3;_key3++)args[_key3-1]=arguments[_key3];var handlerList=handlers[eventName],promises=[];if(handlerList)for(var _i4=0;_i4<handlerList.length;_i4++)!function(_i4){var handler=handlerList[_i4];promises.push(promise_ZalgoPromise.try(function(){return handler.apply(void 0,args)}))}(_i4);return promise_ZalgoPromise.all(promises).then(src_util_noop)},triggerOnce:function(eventName){if(triggered[eventName])return promise_ZalgoPromise.resolve();triggered[eventName]=!0;for(var _len4=arguments.length,args=new Array(1<_len4?_len4-1:0),_key4=1;_key4<_len4;_key4++)args[_key4-1]=arguments[_key4];return this.trigger.apply(this,[eventName].concat(args))},reset:function(){handlers={}}}),props=overrides.props||{},visible=!0,onErrorOverride=overrides.onError,getProxyContainerOverride=overrides.getProxyContainer,showOverride=overrides.show,hideOverride=overrides.hide,closeOverride=overrides.close,renderContainerOverride=overrides.renderContainer,getProxyWindowOverride=overrides.getProxyWindow,setProxyWinOverride=overrides.setProxyWin,openFrameOverride=overrides.openFrame,openPrerenderFrameOverride=overrides.openPrerenderFrame,prerenderOverride=overrides.prerender,openOverride=overrides.open,openPrerenderOverride=overrides.openPrerender,watchForUnloadOverride=overrides.watchForUnload;initChild.onError=onError;function renderTemplate(renderer,_ref6){return renderer({container:_ref6.container,context:_ref6.context,uid:_ref6.uid,doc:_ref6.doc,frame:_ref6.frame,prerenderFrame:_ref6.prerenderFrame,focus:focus,close:close,state:state,props:props,tag:tag,dimensions:dimensions,event:event})}function prerender(proxyPrerenderWin,_ref7){var context=_ref7.context,uid=_ref7.uid;return prerenderOverride?prerenderOverride(proxyPrerenderWin,{context:context,uid:uid}):promise_ZalgoPromise.try(function(){if(prerenderTemplate){var prerenderWindow=proxyPrerenderWin.getWindow();if(prerenderWindow&&isSameDomain(prerenderWindow)&&function(win){try{if(!win.location.href)return 1;if("about:blank"===win.location.href)return 1}catch(err){}}(prerenderWindow)){var doc=(prerenderWindow=assertSameDomain(prerenderWindow)).document,element=renderTemplate(prerenderTemplate,{context:context,uid:uid,doc:doc});if(element){if(element.ownerDocument!==doc)throw new Error("Expected prerender template to have been created with document from child window");!function(win,el){var tag=el.tagName.toLowerCase();if("html"!==tag)throw new Error("Expected element to be html, got "+tag);for(var documentElement=win.document.documentElement,_i6=0,_arrayFrom2=arrayFrom(documentElement.children);_i6<_arrayFrom2.length;_i6++)documentElement.removeChild(_arrayFrom2[_i6]);for(var _i8=0,_arrayFrom4=arrayFrom(el.children);_i8<_arrayFrom4.length;_i8++)documentElement.appendChild(_arrayFrom4[_i8])}(prerenderWindow,element);var element=autoResize.width,width=void 0!==element&&element,element=autoResize.height,height=void 0!==element&&element,element=autoResize.element;(element=getElementSafe(element=void 0===element?"body":element,doc))&&(width||height)&&onResize(element,function(_ref8){resize({width:width?_ref8.width:void 0,height:height?_ref8.height:void 0})},{width:width,height:height,win:prerenderWindow})}}}})}function renderContainer(proxyContainer,_ref9){var proxyFrame=_ref9.proxyFrame,proxyPrerenderFrame=_ref9.proxyPrerenderFrame,context=_ref9.context,uid=_ref9.uid;return renderContainerOverride?renderContainerOverride(proxyContainer,{proxyFrame:proxyFrame,proxyPrerenderFrame:proxyPrerenderFrame,context:context,uid:uid}):promise_ZalgoPromise.hash({container:proxyContainer.get(),frame:proxyFrame?proxyFrame.get():null,prerenderFrame:proxyPrerenderFrame?proxyPrerenderFrame.get():null}).then(function(_ref10){var container=_ref10.container,innerContainer=renderTemplate(containerTemplate,{context:context,uid:uid,container:container,frame:_ref10.frame,prerenderFrame:_ref10.prerenderFrame,doc:document});if(innerContainer)return visible||hideElement(innerContainer),function(container,child){container.appendChild(child)}(container,innerContainer),clean.register(function(){return destroyElement(innerContainer)}),currentProxyContainer=getProxyObject(innerContainer)})}function getHelpers(){return{state:state,event:event,close:close,focus:focus,resize:resize,onError:onError,updateProps:updateProps,show:show,hide:hide}}function setProps(newProps,isUpdate){var helpers=getHelpers();!function(propsDef,props,inputProps,helpers,isUpdate){void 0===isUpdate&&(isUpdate=!1),extend(props,inputProps=newProps||{});for(var propNames=isUpdate?[]:[].concat(Object.keys(propsDef)),_i2=0,_Object$keys2=Object.keys(inputProps);_i2<_Object$keys2.length;_i2++){var key=_Object$keys2[_i2];-1===propNames.indexOf(key)&&propNames.push(key)}for(var aliases=[],state=helpers.state,close=helpers.close,focus=helpers.focus,event=helpers.event,onError=helpers.onError,_i4=0;_i4<propNames.length;_i4++){var _key=propNames[_i4],propDef=propsDef[_key],value=inputProps[_key];if(propDef){var alias=propDef.alias;if(alias&&(null==value&&null!=inputProps[alias]&&(value=inputProps[alias]),aliases.push(alias)),null!=(value=null==(value=propDef.value?propDef.value({props:props,state:state,close:close,focus:focus,event:event,onError:onError}):value)&&propDef.default?propDef.default({props:props,state:state,close:close,focus:focus,event:event,onError:onError}):value)&&("array"===propDef.type?!Array.isArray(value):typeof value!==propDef.type))throw new TypeError("Prop is not of type "+propDef.type+": "+_key);props[_key]=value}}for(var _i6=0;_i6<aliases.length;_i6++)delete props[aliases[_i6]];for(var _i8=0,_Object$keys4=Object.keys(props);_i8<_Object$keys4.length;_i8++){var _key2=_Object$keys4[_i8],_propDef=propsDef[_key2],_value=props[_key2];_propDef&&null!=_value&&_propDef.decorate&&(props[_key2]=_propDef.decorate({value:_value,props:props,state:state,close:close,focus:focus,event:event,onError:onError}))}for(var _i10=0,_Object$keys6=Object.keys(propsDef);_i10<_Object$keys6.length;_i10++){var _key3=_Object$keys6[_i10];if(!1!==propsDef[_key3].required&&null==props[_key3])throw new Error('Expected prop "'+_key3+'" to be defined')}}(propsDef,props,0,helpers,isUpdate=void 0!==isUpdate&&isUpdate)}var updateProps=function(newProps){return setProps(newProps,!0),initPromise.then(function(){var proxyWin=currentProxyWin;if(childComponent&&proxyWin)return childComponent.updateProps(getPropsForChild(getDomainMatcher())).catch(function(err){return checkWindowClose(proxyWin).then(function(closed){if(!closed)throw err})})})};return{init:function(){event.on(EVENT.RENDER,function(){return props.onRender()}),event.on(EVENT.DISPLAY,function(){return props.onDisplay()}),event.on(EVENT.RENDERED,function(){return props.onRendered()}),event.on(EVENT.CLOSE,function(){return props.onClose()}),event.on(EVENT.DESTROY,function(){return props.onDestroy()}),event.on(EVENT.RESIZE,function(){return props.onResize()}),event.on(EVENT.FOCUS,function(){return props.onFocus()}),event.on(EVENT.PROPS,function(newProps){return props.onProps(newProps)}),event.on(EVENT.ERROR,function(err){return props&&props.onError?props.onError(err):initPromise.reject(err).then(function(){setTimeout(function(){throw err},1)})}),clean.register(event.reset)},render:function(target,container,context){return promise_ZalgoPromise.try(function(){var uid="zoid-"+tag+"-"+uniqueID(),domain=getDomainMatcher(),childDomain=getChildDomain();!function(target,domain,container){if(target!==window){if(!isSameTopWindow(window,target))throw new Error("Can only renderTo an adjacent frame");var origin=getDomain();if(!matchDomain(domain,origin)&&!isSameDomain(target))throw new Error("Can not render remotely to "+domain.toString()+" - can only render to "+origin);if(container&&"string"!=typeof container)throw new Error("Container passed to renderTo must be a string selector, got "+typeof container+" }")}}(target,domain,container);var delegatePromise=promise_ZalgoPromise.try(function(){if(target!==window)return function(context,target){for(var delegateProps={},_i4=0,_Object$keys4=Object.keys(props);_i4<_Object$keys4.length;_i4++){var propName=_Object$keys4[_i4],propDef=propsDef[propName];propDef&&propDef.allowDelegate&&(delegateProps[propName]=props[propName])}var childOverridesPromise=send_send(target,"zoid_delegate_"+name,{overrides:{props:delegateProps,event:event,close:close,onError:onError}}).then(function(_ref11){var parent=_ref11.data.parent;return clean.register(function(){if(!isWindowClosed(target))return parent.destroy()}),parent.getDelegateOverrides()}).catch(function(err){throw new Error("Unable to delegate rendering. Possibly the component is not loaded in the target window.\n\n"+stringifyError(err))});return getProxyContainerOverride=function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return childOverridesPromise.then(function(childOverrides){return childOverrides.getProxyContainer.apply(childOverrides,args)})},renderContainerOverride=function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return childOverridesPromise.then(function(childOverrides){return childOverrides.renderContainer.apply(childOverrides,args)})},showOverride=function(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];return childOverridesPromise.then(function(childOverrides){return childOverrides.show.apply(childOverrides,args)})},hideOverride=function(){for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++)args[_key4]=arguments[_key4];return childOverridesPromise.then(function(childOverrides){return childOverrides.hide.apply(childOverrides,args)})},watchForUnloadOverride=function(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];return childOverridesPromise.then(function(childOverrides){return childOverrides.watchForUnload.apply(childOverrides,args)})},context===CONTEXT.IFRAME?(getProxyWindowOverride=function(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];return childOverridesPromise.then(function(childOverrides){return childOverrides.getProxyWindow.apply(childOverrides,args)})},openFrameOverride=function(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++)args[_key7]=arguments[_key7];return childOverridesPromise.then(function(childOverrides){return childOverrides.openFrame.apply(childOverrides,args)})},openPrerenderFrameOverride=function(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++)args[_key8]=arguments[_key8];return childOverridesPromise.then(function(childOverrides){return childOverrides.openPrerenderFrame.apply(childOverrides,args)})},prerenderOverride=function(){for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++)args[_key9]=arguments[_key9];return childOverridesPromise.then(function(childOverrides){return childOverrides.prerender.apply(childOverrides,args)})},openOverride=function(){for(var _len10=arguments.length,args=new Array(_len10),_key10=0;_key10<_len10;_key10++)args[_key10]=arguments[_key10];return childOverridesPromise.then(function(childOverrides){return childOverrides.open.apply(childOverrides,args)})},openPrerenderOverride=function(){for(var _len11=arguments.length,args=new Array(_len11),_key11=0;_key11<_len11;_key11++)args[_key11]=arguments[_key11];return childOverridesPromise.then(function(childOverrides){return childOverrides.openPrerender.apply(childOverrides,args)})}):context===CONTEXT.POPUP&&(setProxyWinOverride=function(){for(var _len12=arguments.length,args=new Array(_len12),_key12=0;_key12<_len12;_key12++)args[_key12]=arguments[_key12];return childOverridesPromise.then(function(childOverrides){return childOverrides.setProxyWin.apply(childOverrides,args)})}),childOverridesPromise}(context,target)}),windowProp=props.window,watchForUnloadPromise=watchForUnload(),buildUrlPromise=function(propsDef,props){var params={},keys=Object.keys(props);return promise_ZalgoPromise.all(keys.map(function(key){var prop=propsDef[key];if(prop)return promise_ZalgoPromise.resolve().then(function(){var value=props[key];if(value&&prop.queryParam)return value}).then(function(value){if(null!=value)return promise_ZalgoPromise.all([function(prop,key,value){return promise_ZalgoPromise.try(function(){return"function"==typeof prop.queryParam?prop.queryParam({value:value}):"string"==typeof prop.queryParam?prop.queryParam:key})}(prop,key,value),function(prop,value){return promise_ZalgoPromise.try(function(){return"function"==typeof prop.queryValue&&null!=value?prop.queryValue({value:value}):value})}(prop,value)]).then(function(queryValue){var queryParam=queryValue[0],queryValue=queryValue[1];if("boolean"==typeof queryValue)result=queryValue.toString();else if("string"==typeof queryValue)result=queryValue.toString();else if("object"==typeof queryValue&&null!==queryValue){if(prop.serialization===PROP_SERIALIZATION.JSON)result=JSON.stringify(queryValue);else if(prop.serialization===PROP_SERIALIZATION.BASE64)result=btoa(JSON.stringify(queryValue));else if(prop.serialization===PROP_SERIALIZATION.DOTIFY||!prop.serialization){for(var result=function dotify(obj,prefix,newobj){for(var key in void 0===newobj&&(newobj={}),prefix=(prefix=void 0===prefix?"":prefix)&&prefix+".",obj)obj.hasOwnProperty(key)&&null!=obj[key]&&"function"!=typeof obj[key]&&(obj[key]&&Array.isArray(obj[key])&&obj[key].length&&obj[key].every(function(val){return"object"!=typeof val})?newobj[""+prefix+key+"[]"]=obj[key].join(","):obj[key]&&"object"==typeof obj[key]?newobj=dotify(obj[key],""+prefix+key,newobj):newobj[""+prefix+key]=obj[key].toString());return newobj}(queryValue,key),_i12=0,_Object$keys8=Object.keys(result);_i12<_Object$keys8.length;_i12++){var dotkey=_Object$keys8[_i12];params[dotkey]=result[dotkey]}return}}else"number"==typeof queryValue&&(result=queryValue.toString());params[queryParam]=result})})})).then(function(){return params})}(propsDef,props).then(function(_originalUrl$split){return originalUrl=normalizeMockUrl(getUrl()),queryString=(originalHash={query:_originalUrl$split}).query||{},hashString=originalHash.hash||{},_originalUrl$split=originalUrl.split("#"),originalHash=_originalUrl$split[1],originalUrl=(_originalUrl$split=(originalUrl=_originalUrl$split[0]).split("?"))[0],queryString=extendQuery(_originalUrl$split[1],queryString),hashString=extendQuery(originalHash,hashString),queryString&&(originalUrl=originalUrl+"?"+queryString),originalUrl=hashString?originalUrl+"#"+hashString:originalUrl;var originalUrl,originalHash,queryString,hashString}),onRenderPromise=event.trigger(EVENT.RENDER),getProxyContainerPromise=getProxyContainer(container),onRenderedPromise=getProxyWindow(),buildWindowNamePromise=onRenderedPromise.then(function(proxyWin){return function(uid){var childPayload,childDomain,domain,context,win,childPayload=(childPayload=(context={proxyWin:uid.proxyWin,childDomain:uid.childDomain,domain:uid.domain,target:uid.target,context:uid.context,uid:uid.uid}).proxyWin,childDomain=context.childDomain,domain=context.domain,void 0===context.target&&window,{uid:uid=context.uid,context:context=context.context,tag:tag,version:"9_0_43",childDomain:childDomain,parentDomain:getDomain(window),parent:function(domain,uid,context){if(domain!==getDomain(window))return context===CONTEXT.POPUP?{type:"opener"}:{type:"parent",distance:getDistanceFromTop(window)};var global=lib_global_getGlobal(window);return global.windows=global.windows||{},global.windows[uid]=window,clean.register(function(){delete global.windows[uid]}),{type:"global",uid:uid}}(childDomain,uid,context),props:function(proxyWin,propRef,value,uid){var global,value=setup_serializeMessage(proxyWin,value,getPropsForChild(value)),propRef=propRef===getDomain()?{type:"uid",uid:uid}:{type:"raw",value:value};return"uid"===propRef.type&&((global=lib_global_getGlobal(window)).props=global.props||{},global.props[uid]=value,clean.register(function(){delete global.props[uid]})),propRef}(childPayload,childDomain,domain,uid),exports:setup_serializeMessage(childPayload,domain,(win=childPayload,{init:initChild,close:close,checkClose:function(){return checkWindowClose(win)},resize:resize,onError:onError,show:show,hide:hide}))});return"__zoid__"+name+"__"+base64encode(JSON.stringify(childPayload))+"__"}({proxyWin:proxyWin,childDomain:childDomain,domain:domain,target:target,context:context,uid:uid})}),openFramePromise=buildWindowNamePromise.then(function(windowName){return openFrame(context,{windowName:windowName})}),openPrerenderFramePromise=openPrerenderFrame(context),renderContainerPromise=promise_ZalgoPromise.hash({proxyContainer:getProxyContainerPromise,proxyFrame:openFramePromise,proxyPrerenderFrame:openPrerenderFramePromise}).then(function(_ref12){return renderContainer(_ref12.proxyContainer,{context:context,uid:uid,proxyFrame:_ref12.proxyFrame,proxyPrerenderFrame:_ref12.proxyPrerenderFrame})}).then(function(proxyContainer){return proxyContainer}),openPromise=promise_ZalgoPromise.hash({windowName:buildWindowNamePromise,proxyFrame:openFramePromise,proxyWin:onRenderedPromise}).then(function(_ref13){var proxyWin=_ref13.proxyWin;return windowProp?proxyWin:open(context,{windowName:_ref13.windowName,proxyWin:proxyWin,proxyFrame:_ref13.proxyFrame})}),openPrerenderPromise=promise_ZalgoPromise.hash({proxyWin:openPromise,proxyPrerenderFrame:openPrerenderFramePromise}).then(function(_ref14){return openPrerender(context,_ref14.proxyWin,_ref14.proxyPrerenderFrame)}),setStatePromise=openPromise.then(function(proxyWin){return setProxyWin(currentProxyWin=proxyWin)}),prerenderPromise=promise_ZalgoPromise.hash({proxyPrerenderWin:openPrerenderPromise,state:setStatePromise}).then(function(_ref15){return prerender(_ref15.proxyPrerenderWin,{context:context,uid:uid})}),setWindowNamePromise=promise_ZalgoPromise.hash({proxyWin:openPromise,windowName:buildWindowNamePromise}).then(function(_ref16){if(windowProp)return _ref16.proxyWin.setName(_ref16.windowName)}),loadUrlPromise=promise_ZalgoPromise.hash({proxyWin:openPromise,builtUrl:buildUrlPromise,windowName:setWindowNamePromise,prerender:prerenderPromise}).then(function(_ref17){return _ref17.proxyWin.setLocation(_ref17.builtUrl)}),watchForClosePromise=openPromise.then(function(proxyWin){!function watchForClose(proxyWin){var cancelled=!1;return clean.register(function(){cancelled=!0}),promise_ZalgoPromise.delay(2e3).then(function(){return proxyWin.isClosed()}).then(function(isClosed){return isClosed?close():cancelled?void 0:watchForClose(proxyWin)})}(proxyWin)}),onDisplayPromise=promise_ZalgoPromise.hash({container:renderContainerPromise,prerender:prerenderPromise}).then(function(){return event.trigger(EVENT.DISPLAY)}),openBridgePromise=openPromise.then(function(proxyWin){return function(proxyWin,domain,context){return promise_ZalgoPromise.try(function(){return proxyWin.awaitWindow()}).then(function(win){if(src_bridge&&src_bridge.needsBridge({win:win,domain:domain})&&!src_bridge.hasBridge(domain,domain)){var bridgeUrl=options.bridgeUrl;if(!bridgeUrl)throw new Error("Bridge needed to render "+context);var bridgeDomain=getDomainFromUrl(bridgeUrl);return src_bridge.linkUrl(win,domain),src_bridge.openBridge(normalizeMockUrl(bridgeUrl),bridgeDomain)}})}(proxyWin,childDomain,context)}),runTimeoutPromise=loadUrlPromise.then(function(){return promise_ZalgoPromise.try(function(){var timeout=props.timeout;if(timeout)return initPromise.timeout(timeout,new Error("Loading component timed out after "+timeout+" milliseconds"))})}),onRenderedPromise=initPromise.then(function(){return event.trigger(EVENT.RENDERED)});return promise_ZalgoPromise.hash({initPromise:initPromise,buildUrlPromise:buildUrlPromise,onRenderPromise:onRenderPromise,getProxyContainerPromise:getProxyContainerPromise,openFramePromise:openFramePromise,openPrerenderFramePromise:openPrerenderFramePromise,renderContainerPromise:renderContainerPromise,openPromise:openPromise,openPrerenderPromise:openPrerenderPromise,setStatePromise:setStatePromise,prerenderPromise:prerenderPromise,loadUrlPromise:loadUrlPromise,buildWindowNamePromise:buildWindowNamePromise,setWindowNamePromise:setWindowNamePromise,watchForClosePromise:watchForClosePromise,onDisplayPromise:onDisplayPromise,openBridgePromise:openBridgePromise,runTimeoutPromise:runTimeoutPromise,onRenderedPromise:onRenderedPromise,delegatePromise:delegatePromise,watchForUnloadPromise:watchForUnloadPromise})}).catch(function(err){return promise_ZalgoPromise.all([onError(err),destroy(err)]).then(function(){throw err},function(){throw err})}).then(src_util_noop)},destroy:destroy,setProps:setProps,getHelpers:getHelpers,getDelegateOverrides:function(){return promise_ZalgoPromise.try(function(){return{getProxyContainer:getProxyContainer,show:show,hide:hide,renderContainer:renderContainer,getProxyWindow:getProxyWindow,watchForUnload:watchForUnload,openFrame:openFrame,openPrerenderFrame:openPrerenderFrame,prerender:prerender,open:open,openPrerender:openPrerender,setProxyWin:setProxyWin}})}}}function defaultContainerTemplate(height){var uid=height.uid,frame=height.frame,prerenderFrame=height.prerenderFrame,doc=height.doc,props=height.props,event=height.event,style=height.dimensions,width=style.width,height=style.height;if(frame&&prerenderFrame){var div=doc.createElement("div");div.setAttribute("id",uid);style=doc.createElement("style");return props.cspNonce&&style.setAttribute("nonce",props.cspNonce),style.appendChild(doc.createTextNode("\n            #"+uid+" {\n                display: inline-block;\n                position: relative;\n                width: "+width+";\n                height: "+height+";\n            }\n\n            #"+uid+" > iframe {\n                display: inline-block;\n                position: absolute;\n                width: 100%;\n                height: 100%;\n                top: 0;\n                left: 0;\n                transition: opacity .2s ease-in-out;\n                border-width: 0 0 2px 0;\n            }\n\n            #"+uid+" > iframe.zoid-invisible {\n                opacity: 0;\n            }\n\n            #"+uid+" > iframe.zoid-visible {\n                opacity: 1;\n        }\n        ")),div.appendChild(frame),div.appendChild(prerenderFrame),div.appendChild(style),prerenderFrame.classList.add("zoid-visible"),frame.classList.add("zoid-invisible"),event.on(EVENT.RENDERED,function(){prerenderFrame.classList.remove("zoid-visible"),prerenderFrame.classList.add("zoid-invisible"),frame.classList.remove("zoid-invisible"),frame.classList.add("zoid-visible"),setTimeout(function(){destroyElement(prerenderFrame)},1)}),event.on(EVENT.RESIZE,function(newHeight){var newWidth=newHeight.width,newHeight=newHeight.height;"number"==typeof newWidth&&(div.style.width=toCSS(newWidth)),"number"==typeof newHeight&&(div.style.height=toCSS(newHeight))}),div}}function defaultPrerenderTemplate(spinner){var doc=spinner.doc,props=spinner.props,html=doc.createElement("html"),body=doc.createElement("body"),style=doc.createElement("style"),spinner=doc.createElement("div");return spinner.classList.add("spinner"),props.cspNonce&&style.setAttribute("nonce",props.cspNonce),html.appendChild(body),body.appendChild(spinner),body.appendChild(style),style.appendChild(doc.createTextNode("\n            html, body {\n                width: 100%;\n                height: 100%;\n            }\n\n            .spinner {\n                position: fixed;\n                max-height: 60vmin;\n                max-width: 60vmin;\n                height: 40px;\n                width: 40px;\n                top: 50%;\n                left: 50%;\n                box-sizing: border-box;\n                border: 3px solid rgba(0, 0, 0, .2);\n                border-top-color: rgba(33, 128, 192, 0.8);\n                border-radius: 100%;\n                animation: rotation .7s infinite linear;\n            }\n\n            @keyframes rotation {\n                from {\n                    transform: translateX(-50%) translateY(-50%) rotate(0deg);\n                }\n                to {\n                    transform: translateX(-50%) translateY(-50%) rotate(359deg);\n                }\n            }\n        ")),html}var props_defaultNoop=function(){return src_util_noop},props_decorateOnce=function(_ref){return once(_ref.value)},component_clean=cleanup();function component_component(opts){function isChild(){var payload=getChildPayload();return Boolean(payload&&payload.tag===tag&&payload.childDomain===getDomain())}var options=function(){var tag=opts.tag,url=opts.url,domain=opts.domain,bridgeUrl=opts.bridgeUrl,logger=opts.props,propsDef=void 0===logger?{}:logger,containerTemplate=opts.dimensions,height=void 0===containerTemplate?{}:containerTemplate,name=opts.autoResize,autoResize=void 0===name?{}:name,prerenderTemplate=opts.allowedParentDomains,allowedParentDomains=void 0===prerenderTemplate?"*":prerenderTemplate,validate=opts.attributes,attributes=void 0===validate?{}:validate,width=opts.defaultContext,defaultContext=void 0===width?CONTEXT.IFRAME:width,logger=opts.containerTemplate,containerTemplate=void 0===logger?defaultContainerTemplate:logger,name=opts.prerenderTemplate,prerenderTemplate=void 0===name?defaultPrerenderTemplate:name,validate=opts.validate,width=opts.logger,logger=void 0===width?{info:src_util_noop}:width,name=tag.replace(/-/g,"_"),width=height.width,width=void 0===width?"300px":width,height=height.height,height=void 0===height?"150px":height,propsDef=_extends({},{window:{type:"object",sendToChild:!1,required:!1,allowDelegate:!0,validate:function(_ref2){},decorate:function(_ref3){return setup_toProxyWindow(_ref3.value)}},timeout:{type:"number",required:!1,sendToChild:!1},close:{type:"function",required:!1,sendToChild:!1,childDecorate:function(_ref4){return _ref4.close}},focus:{type:"function",required:!1,sendToChild:!1,childDecorate:function(_ref5){return _ref5.focus}},resize:{type:"function",required:!1,sendToChild:!1,childDecorate:function(_ref6){return _ref6.resize}},cspNonce:{type:"string",required:!1},getParent:{type:"function",required:!1,sendToChild:!1,childDecorate:function(_ref7){return _ref7.getParent}},getParentDomain:{type:"function",required:!1,sendToChild:!1,childDecorate:function(_ref8){return _ref8.getParentDomain}},show:{type:"function",required:!1,sendToChild:!1,childDecorate:function(_ref9){return _ref9.show}},hide:{type:"function",required:!1,sendToChild:!1,childDecorate:function(_ref10){return _ref10.hide}},onDisplay:{type:"function",required:!1,sendToChild:!1,allowDelegate:!0,default:props_defaultNoop,decorate:props_decorateOnce},onRendered:{type:"function",required:!1,sendToChild:!1,default:props_defaultNoop,decorate:props_decorateOnce},onRender:{type:"function",required:!1,sendToChild:!1,default:props_defaultNoop,decorate:props_decorateOnce},onClose:{type:"function",required:!1,sendToChild:!1,allowDelegate:!0,default:props_defaultNoop,decorate:props_decorateOnce},onDestroy:{type:"function",required:!1,sendToChild:!1,allowDelegate:!0,default:props_defaultNoop,decorate:props_decorateOnce},onResize:{type:"function",required:!1,sendToChild:!1,allowDelegate:!0,default:props_defaultNoop},onFocus:{type:"function",required:!1,sendToChild:!1,allowDelegate:!0,default:props_defaultNoop},onError:{type:"function",required:!1,sendToChild:!1,childDecorate:function(_ref11){return _ref11.onError}},onProps:{type:"function",required:!1,sendToChild:!1,default:props_defaultNoop,childDecorate:function(_ref12){return _ref12.onProps}}},propsDef);if(!containerTemplate)throw new Error("Container template required");return{name:name,tag:tag,url:url,domain:domain,bridgeUrl:bridgeUrl,propsDef:propsDef,dimensions:{width:width,height:height},autoResize:autoResize,allowedParentDomains:allowedParentDomains,attributes:attributes,defaultContext:defaultContext,containerTemplate:containerTemplate,prerenderTemplate:prerenderTemplate,validate:validate,logger:logger}}(),name=options.name,tag=options.tag,defaultContext=options.defaultContext,global=lib_global_getGlobal(),registerChild=memoize(function(){if(isChild()){if(window.xprops)throw delete global.components[tag],new Error("Can not register "+name+" as child - child already registered");var child=function(exports){var props,propsDef=exports.propsDef,autoResize=exports.autoResize,allowedParentDomains=exports.allowedParentDomains,onPropHandlers=[],childPayload=getChildPayload();if(!childPayload)throw new Error("No child payload found");if("9_0_43"!==childPayload.version)throw new Error("Parent window has zoid version "+childPayload.version+", child window has version 9_0_43");function getParent(){return parentComponentWindow}function getParentDomain(){return parentDomain}function onProps(handler){onPropHandlers.push(handler)}function onError(err){return promise_ZalgoPromise.try(function(){if(parent&&parent.onError)return parent.onError(err);throw err})}function resize(_ref2){return parent.resize.fireAndForget({width:_ref2.width,height:_ref2.height})}function setProps(newProps,origin,normalizedProps){normalizedProps=function(parentComponentWindow,propsDef,props,origin,helpers,isUpdate){void 0===isUpdate&&(isUpdate=!1);for(var result={},_i2=0,_Object$keys2=Object.keys(props);_i2<_Object$keys2.length;_i2++){var value,key=_Object$keys2[_i2],prop=propsDef[key];prop&&prop.sameDomain&&(origin!==getDomain(window)||!isSameDomain(parentComponentWindow))||(value=normalizeChildProp(propsDef,0,key,props[key],helpers),result[key]=value,prop&&prop.alias&&!result[prop.alias]&&(result[prop.alias]=value))}if(!isUpdate)for(var _i4=0,_Object$keys4=Object.keys(propsDef);_i4<_Object$keys4.length;_i4++){var _key=_Object$keys4[_i4];props.hasOwnProperty(_key)||(result[_key]=normalizeChildProp(propsDef,0,_key,void 0,helpers))}return result}(parentComponentWindow,propsDef,newProps,origin,{show:show,hide:hide,close:close,focus:child_focus,onError:onError,resize:resize,onProps:onProps,getParent:getParent,getParentDomain:getParentDomain},normalizedProps=void 0===normalizedProps?!1:normalizedProps),props?extend(props,normalizedProps):props=normalizedProps;for(var _i4=0;_i4<onPropHandlers.length;_i4++)(0,onPropHandlers[_i4])(props)}function updateProps(newProps){return promise_ZalgoPromise.try(function(){return setProps(newProps,parentDomain,!0)})}var parentDomain=childPayload.parentDomain,exports=childPayload.exports,context=childPayload.context,propsRef=childPayload.props,parentComponentWindow=function(ancestor){var win,n,type=ancestor.type;if("opener"===type)return assertExists("opener",getOpener(window));if("parent"===type&&"number"==typeof ancestor.distance)return assertExists("parent",(win=window,void 0===(n=ancestor.distance)&&(n=1),function(win,n){void 0===n&&(n=1);for(var parent=win,i=0;i<n;i++){if(!parent)return;parent=utils_getParent(parent)}return parent}(win,getDistanceFromTop(win)-n)));if("global"===type&&ancestor.uid&&"string"==typeof ancestor.uid){var uid=ancestor.uid,ancestor=getAncestor(window);if(!ancestor)throw new Error("Can not find ancestor window");for(var _i2=0,_getAllFramesInWindow2=getAllFramesInWindow(ancestor);_i2<_getAllFramesInWindow2.length;_i2++){var global=_getAllFramesInWindow2[_i2];if(isSameDomain(global)){global=lib_global_getGlobal(global);if(global&&global.windows&&global.windows[uid])return global.windows[uid]}}}throw new Error("Unable to find "+type+" parent component window")}(childPayload.parent),parent=setup_deserializeMessage(parentComponentWindow,parentDomain,exports),show=parent.show,hide=parent.hide,close=parent.close;return{init:function(){return promise_ZalgoPromise.try(function(){return function(allowedParentDomains,domain){if(!matchDomain(allowedParentDomains,domain))throw new Error("Can not be rendered by domain: "+domain)}(allowedParentDomains,parentDomain),markWindowKnown(parentComponentWindow),window.addEventListener("beforeunload",function(){parent.checkClose.fireAndForget()}),window.addEventListener("unload",function(){parent.checkClose.fireAndForget()}),onCloseWindow(parentComponentWindow,function(){child_destroy()}),parent.init({updateProps:updateProps,close:child_destroy})}).then(function(){return waitForDocumentReady().then(function(){if(document.body)return document.body;throw new Error("Document ready but document.body not present")}).then(function(){var _autoResize$width,_autoResize$height,_autoResize$element,element=(_autoResize$width=autoResize.width,_autoResize$height=autoResize.height,_autoResize$element=autoResize.element,{width:void 0!==_autoResize$width&&_autoResize$width,height:void 0!==_autoResize$height&&_autoResize$height,element:getElementSafe(void 0===_autoResize$element?"body":_autoResize$element)}),width=element.width,height=element.height,element=element.element;element&&(width||height)&&context!==CONTEXT.POPUP&&onResize(element,function(_ref3){resize({width:width?_ref3.width:void 0,height:height?_ref3.height:void 0})},{width:width,height:height})})}).catch(function(err){onError(err)})},getProps:function(){return props||(setProps(function(parentComponentWindow,domain){var global=propsRef.type,uid=propsRef.uid;if("raw"===global)props=propsRef.value;else if("uid"===global){if(!isSameDomain(parentComponentWindow))throw new Error("Parent component window is on a different domain - expected "+getDomain()+" - can not retrieve props");var global=lib_global_getGlobal(parentComponentWindow),props=assertExists("props",global&&global.props[uid])}if(!props)throw new Error("Could not find props");return setup_deserializeMessage(parentComponentWindow,domain,props)}(parentComponentWindow,parentDomain),parentDomain),props)}}}(options);return child.init(),child}});if(registerChild(),on_on("zoid_allow_delegate_"+name,function(){return!0}),on_on("zoid_delegate_"+name,function(_ref){return{parent:parentComponent(options,_ref.data.overrides,_ref.source)}}),global.components=global.components||{},global.components[tag])throw new Error("Can not register multiple components with the same tag: "+tag);return global.components[tag]=!0,{init:function(props){(props=props||{}).onDestroy=memoize(props.onDestroy||src_util_noop);var parent=parentComponent(options);parent.init(),parent.setProps(props),component_clean.register(function(){parent.destroy(new Error("zoid destroyed all components"))});function _render(target,container,context){return promise_ZalgoPromise.try(function(){if(!isWindow(target))throw new Error("Must pass window to renderTo");return function(props,context){return promise_ZalgoPromise.try(function(){if(props.window)return setup_toProxyWindow(props.window).getType();if(context){if(context!==CONTEXT.IFRAME&&context!==CONTEXT.POPUP)throw new Error("Unrecognized context: "+context);return context}return defaultContext})}(props,context)}).then(function(finalContext){return container=function(context,container){if(container){if("string"!=typeof container&&!isElement(container))throw new TypeError("Expected string or element selector to be passed");return container}if(context===CONTEXT.POPUP)return"body";throw new Error("Expected element to be passed to render iframe")}(finalContext,container),parent.render(target,container,finalContext)}).catch(function(err){return parent.destroy(err).then(function(){throw err})})}return _extends({},parent.getHelpers(),{render:function(container,context){return _render(window,container,context)},renderTo:_render})},driver:function(driverName,dep){throw new Error("Driver support not enabled")},isChild:isChild,canRenderTo:function(win){return send_send(win,"zoid_allow_delegate_"+name).then(function(_ref2){return _ref2.data}).catch(function(){return!1})},registerChild:registerChild}}function create(child){var on,send;global_getGlobal().initialized||(global_getGlobal().initialized=!0,on=(init={on:on_on,send:send_send}).on,send=init.send,(init=global_getGlobal()).receiveMessage=init.receiveMessage||function(message){return receive_receiveMessage(message,{on:on,send:send})},function(_ref5){var on=_ref5.on,send=_ref5.send;globalStore().getOrSet("postMessageListener",function(){return addEventListener(window,"message",function(event){!function(data,origin){var on=origin.on,send=origin.send,source=data.source||data.sourceElement,origin=data.origin||data.originalEvent&&data.originalEvent.origin,data=data.data;if("null"===origin&&(origin="file://"),source){if(!origin)throw new Error("Post message did not have origin domain");receive_receiveMessage({source:source,origin:origin,data:data},{on:on,send:send})}}(event,{on:on,send:send})})})}({on:on_on,send:send_send}),setupBridge({on:on_on,send:send_send,receiveMessage:receive_receiveMessage}),function(_ref8){var on=_ref8.on,send=_ref8.send;globalStore("builtinListeners").getOrSet("helloListener",function(){var listener=on("postrobot_hello",{domain:"*"},function(_ref3){return resolveHelloPromise(_ref3.source,{domain:_ref3.origin}),{instanceID:getInstanceID()}}),parent=getAncestor();return parent&&sayHello(parent,{send:send}).catch(src_util_noop),listener})}({on:on_on,send:send_send}));var comp=component_component(child),init=function(props){return comp.init(props)};init.driver=function(name,dep){return comp.driver(name,dep)},init.isChild=function(){return comp.isChild()},init.canRenderTo=function(win){return comp.canRenderTo(win)};child=comp.registerChild();return child&&(window.xprops=init.xprops=child.getProps()),init}function destroyAll(){src_bridge&&src_bridge.destroyBridges();var destroyPromise=component_clean.all();return component_clean=cleanup(),destroyPromise}var destroyComponents=destroyAll;function component_destroy(){var listener;destroyAll(),delete window.__zoid_9_0_43__,function(){for(var responseListeners=globalStore("responseListeners"),_i2=0,_responseListeners$ke2=responseListeners.keys();_i2<_responseListeners$ke2.length;_i2++){var hash=_responseListeners$ke2[_i2],listener=responseListeners.get(hash);listener&&(listener.cancelled=!0),responseListeners.del(hash)}}(),(listener=globalStore().get("postMessageListener"))&&listener.cancel(),delete window.__post_robot_10_0_31__}}],installedModules={},__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return{}.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=0);function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var modules,installedModules});var componentRenderinit=document.createElement("script");componentRenderinit.setAttribute("src",host+"/ge-render-component.js"),componentRenderinit.setAttribute("type","text/javascript"),componentRenderinit.setAttribute("async","false"),document.body.appendChild(componentRenderinit);